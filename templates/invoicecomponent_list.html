{# <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /> #}
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
<html lang="en">
<head>
<title>{{company_name|capfirst}}{{category_name|capfirst}} - Наявний товар</title>

{% comment %}
<link rel="stylesheet" href="/media/jquery-ui.min.css">
{% endcomment %}

<link rel="stylesheet" href="/media/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="/media/css/dataTables.jqueryui.css">
<link rel="stylesheet" href="/media/css/select.dataTables.min.css">
<link rel="stylesheet" href="/media/css/datepicker.min.css">

<link rel="stylesheet" type="text/css" href="/media/css/table.css">
<link rel="stylesheet" href="/media/css/mainstyle.css">


{# <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> #}  	
{# <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"> #} 	
{# <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/typicons/2.0.7/typicons.min.css" /> #}


{% comment %}  	 
<script type="text/javascript" src="/media/jquery-ui.min.js"></script>
{% endcomment %}

<script type="text/javascript" language="javascript" src="/media/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="/media/dataTables.jqueryui.js"></script>
<script type="text/javascript" language="javascript" src="/media/dataTables.select.min.js"></script>
{# <script type="text/javascript" language="javascript" src="/media/dataTables.buttons.min.js"></script> #}
<script src="/media/jquery.jeditable.mini.js" type="text/javascript" charset="utf-8"></script>
{#<script src="/media/jssor.slider.mini.js"></script>#}
  	


<script src="/media/js/datepicker.min.js"></script> 

</head>

<style>

.material-icons.md-18 { font-size: 18px; }
.material-icons.md-24 { font-size: 24px; }
.material-icons.md-36 { font-size: 36px; }
.material-icons.md-48 { font-size: 48px; }

.table-yellow{
	background-color: #feff81;
}

.photoModalbutton{
	cursor: pointer;
}

  .custom-combobox {
    position: relative;
    display: inline-block;
  }
  .custom-combobox-toggle {
    position: absolute;
    top: 0;
    bottom: 0;
    margin-left: -1px;
    padding: 0;
  }
  .custom-combobox-input {
    margin: 0;
    padding: 5px 10px;
  }
  
  a.toggle-vis {color:#293d6b; 
  		cursor: pointer; 
  		border-radius: 3px;
  		color: #FFF;
  		background-color: #cecccc;
/*  		border-right:10px solid #cecccc; */
  		}

#container {
    border: 2px solid red;
    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
}  

.cdiv {
 /*   float: left; */
 	float:left;
    display: inline-block
    vertical-align: middle;
    margin: 2px;
	height: 2em;
	font-size: 12pt;    
}
  
  .zero{
  	clear: both;
  	color: black;
	background: #CCCC99 !important; 
/*	background-color: #CCCC99; !important; */
  }
  
  .zero.odd.selected{
  	background: #a4b2cb !important;
  }

  .zero.even.selected{
  	background: #a4b2cb !important;
  }
  
  .last{
  	clear: both;
	background: #FFFF99 !important;
  }

  .last.odd.selected{
  	background: #a4b2cb !important;
  }

  .last.even.selected{
  	background: #a4b2cb !important;
  }


  .tr_true{
  	clear: both;
	background: #CCCC99 !important;
  }
  .tr_false{
  	clear: both;
	background: #FFFFFF !important;
  }

 td.locality_edit{
    font-size: 11px;
 }

.slideme {
max-width: 500px;
max-height: 300px;
width: 100%;
height: 100%;
}
 
#b_buy, #email_send, #all_record_show{
cursor: pointer; 
}  

            /* jssor slider bullet navigator skin 01 css */
            /*
            .jssorb01 div           (normal)
            .jssorb01 div:hover     (normal mouseover)
            .jssorb01 .av           (active)
            .jssorb01 .av:hover     (active mouseover)
            .jssorb01 .dn           (mousedown)
            */
            .jssorb01 {
                position: absolute;
            }
            .jssorb01 div, .jssorb01 div:hover, .jssorb01 .av {
                position: absolute;
                /* size of bullet elment */
                width: 12px;
                height: 12px;
                filter: alpha(opacity=70);
                opacity: .7;
                overflow: hidden;
                cursor: pointer;
                border: #000 1px solid;
            }
            .jssorb01 div { background-color: gray; }
            .jssorb01 div:hover, .jssorb01 .av:hover { background-color: #d3d3d3; }
            .jssorb01 .av { background-color: #fff; }
            .jssorb01 .dn, .jssorb01 .dn:hover { background-color: #555555; }

            /* jssor slider arrow navigator skin 03 css */
            /*
            .jssora03l                  (normal)
            .jssora03r                  (normal)
            .jssora03l:hover            (normal mouseover)
            .jssora03r:hover            (normal mouseover)
            .jssora03l.jssora03ldn      (mousedown)
            .jssora03r.jssora03rdn      (mousedown)
            */
            .jssora03l, .jssora03r {
                display: block;
                position: absolute;
                /* size of arrow element */
                width: 55px;
                height: 55px;
                cursor: pointer;
                background: url(/media/images/a02.png) no-repeat;
                overflow: hidden;
            }
            .jssora03l { background-position: -3px -33px; }
            .jssora03r { background-position: -63px -33px; }
            .jssora03l:hover { background-position: -123px -33px; }
            .jssora03r:hover { background-position: -183px -33px; }
            .jssora03l.jssora03ldn { background-position: -243px -33px; }
            .jssora03r.jssora03rdn { background-position: -303px -33px; }

.green-icon {
  color: green;
  font-style: normal;
  size: 300px;
}
/*
#iTable a{
	color: #272728;	
}*/

.div_c_name {
    float: left;
    margin-right: 10px;
}

.price_tag {
    float:right;
}

</style>
        

{% load poll_extras %}
        
<script type="text/javascript">

function resize_dialog_width(lim_width) { 
    if ($( window ).width() >= lim_width){ 
          return ($( window ).width() / 2); 
        } 
    else {
          return ($( window ).width() - 50);
        } 
};


function copy2clipboard() {
	  var copyText = document.getElementById("print_container").innerText;
	  var copyTextInput = document.getElementById("inputLink");
	  copyTextInput.value = copyText;

	    /* Select the text field */
	    copyTextInput.select();
	    copyTextInput.setSelectionRange(0, 99999); /*For mobile devices*/

	    /* Copy the text inside the text field */
	    document.execCommand("copy");
	    console.log("copied!\n" + copyTextInput.value);	  

/*	  var elem = document.createElement("textarea_clipboard");
	  document.body.appendChild(elem);
	  elem.value = copyText; */
//	  copyText.select();  
//	  document.execCommand("copy"); 
	  //document.body.removeChild(elem);
	  alert("Copied the text");
	}


"use strict";

function copyToClipboard(elem) {
  var target = elem;
  // select the content
  var currentFocus = document.activeElement;
  target.focus();
  target.setSelectionRange(0, target.value.length);
  // copy the selection
  var succeed;
  try {
    succeed = document.execCommand("copy");
  } catch (e) {
    console.warn(e);
    succeed = false;
  }
  // Restore original focus
  if (currentFocus && typeof currentFocus.focus === "function") {
    currentFocus.focus();
  }
  if (succeed) {
	  alert("Copied the text");
/*    $(".copied").animate({ top: -25, opacity: 0 }, 700, function() {
      $(this).css({ top: 0, opacity: 1 });
    });*/
  }
  return succeed;
}


jQuery(document).ready(function ($) {

{% if qsearch_lookup == False %}
	$("#q_search").hide();
{% endif %}

$(".year_sales").hide();

	
	$("div.price_tag").hide();		

jQuery.extend( jQuery.fn.dataTableExt.oSort, {
    "currency-html-pre": function ( a ) {
        var x = a.replace( /<.*?>/g, "" );
        a = (x==="-") ? 0 : x.replace( /[^\d\-\.]/g, "" );
        return parseFloat( a );
    },
 
    "currency-html-asc": function ( a, b ) {
        return a - b;
    },
 
    "currency-html-desc": function ( a, b ) {
        return b - a;
    }
} );


$('[data-toggle="datepicker"]').on('hide.datepicker', function (e) {
	console.log("Click datepicker + " + $(this).datepicker('getDate', true));
	console.log("TR = " + $(this).parents('td').parents('tr').attr('id') );
	update_enddate( $(this).parents('td').parents('tr').attr('id'), $(this).datepicker('getDate', true) )
});

function update_enddate(pk, date) {
	$.ajax({
	    type: "POST",
	    url: "{% url 'cat_set_attr' %}",
		{# url: '/catalog/edit/', #}
	    data: {id:  pk, update_enddate: date},
	    dataType : 'json',
	    success:function(json){
	    	if (json['status'] == true) {
				console.log("Дату змінено");
	    	}
	   		else {
	   			console.log('JSON = ' + json['error'] + ' STATUS = ' + json['status'] );
	   		    alert("Помилка: " + json['error']);
	   		}
	    },
	    error:function(){
	     alert("При отправке возникли проблемы");
	    }
	 });
};



$("#copyButton, #copyTarget").on("click", function() {
  copyToClipboard(document.getElementById("copyTarget"));
});


});


(function( $ ) {
    $.widget( "custom.combobox", {
      _create: function() {
        this.wrapper = $( "<span>" )
          .addClass( "custom-combobox" )
          .insertAfter( this.element );
 
        this.element.hide();
        this._createAutocomplete();
        this._createShowAllButton();
      },
 
      _createAutocomplete: function() {
        var selected = this.element.children( ":selected" ),
          value = selected.val() ? selected.text() : "";
 
        this.input = $( "<input>" )
          .appendTo( this.wrapper )
          .val( value )
          .attr( "title", "" )
          .addClass( "custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left" )
          .autocomplete({
            delay: 0,
            minLength: 0,
            select: function( event, ui ) {
            	$("#c_c").html("(Завантажується..." + ui.item.value + ")");
//            	console.log("SELECT = " + ui.item.option.value);
//            	console.log("SELECT VALUE = " + ui.item.value);
            	window.location.href = ui.item.option.value;
            },
            source: $.proxy( this, "_source" )
          })
          .tooltip({
            tooltipClass: "ui-state-highlight"
          });
 
        this._on( this.input, {
          autocompleteselect: function( event, ui ) {
            ui.item.option.selected = true;
            this._trigger( "select", event, {
              item: ui.item.option
            });
          },
 
          autocompletechange: "_removeIfInvalid"
        });
      },
 
      _createShowAllButton: function() {
        var input = this.input,
          wasOpen = false;
 
        $( "<a>" )
          .attr( "tabIndex", -1 )
          .attr( "title", "Show All Items" )
          .tooltip()
          .appendTo( this.wrapper )
          .button({
            icons: {
              primary: "ui-icon-triangle-1-s"
            },
            text: false
          })
          .removeClass( "ui-corner-all" )
          .addClass( "custom-combobox-toggle ui-corner-right" )
          .mousedown(function() {
            wasOpen = input.autocomplete( "widget" ).is( ":visible" );
          })
          .click(function() {
            input.focus();
 
            // Close if already visible
            if ( wasOpen ) {
              return;
            }
 
            // Pass empty string as value to search for, displaying all results
            input.autocomplete( "search", "" );
          });
      },
 
      _source: function( request, response ) {
        var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), "i" );
        response( this.element.children( "option" ).map(function() {
          var text = $( this ).text();
          if ( this.value && ( !request.term || matcher.test(text) ) )
            return {
              label: text,
              //value: this.value,
              value: text,
              option: this
            };
        }) );
      },
 
      _removeIfInvalid: function( event, ui ) {
 
        // Selected an item, nothing to do
        if ( ui.item ) {
          return;
        }
 
        // Search for a match (case-insensitive)
        var value = this.input.val(),
          valueLowerCase = value.toLowerCase(),
          valid = false;
        this.element.children( "option" ).each(function() {
          if ( $( this ).text().toLowerCase() === valueLowerCase ) {
            this.selected = valid = true;
            return false;
          }
        });
 
        // Found a match, nothing to do
        if ( valid ) {
          return;
        }
 
        // Remove invalid value
        this.input
          .val( "" )
          .attr( "title", value + " didn't match any item" )
          .tooltip( "open" );
        this.element.val( "" );
        this._delay(function() {
          this.input.tooltip( "close" ).attr( "title", "" );
        }, 2500 );
        this.input.autocomplete( "instance" ).term = "";
      },
 
      _destroy: function() {
        this.wrapper.remove();
        this.element.show();
      }
    });
})( jQuery );



$(document).ready(function() {

//	$('[data-toggle="tooltip"]').tooltip();	
	
	// DataTable
    var table = $('#iTable').DataTable({
        "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
        "iDisplayLength": 100,        
        select: {style: 'multi'},
        "columnDefs": [
            {
                "targets": [ 1 ],
                "visible": false,
                "searchable": false
            },
            {
                "targets": [ 2 ],
                "visible": false
            },
            {
                "targets": [ 3 ],
                "visible": false
            },
            {
                "targets": [ 8 ], // наявність
                "visible": true,

                "sWidth": "15px",
            },
            
            {
                "targets": [ 10 ],
                "visible": true,
                "sType": "currency-html",
            },
            {
                "targets": [ 12 ],
                "visible": false,
                "searchable": false
            },
            {
                "targets": [ 15 ], // box
                "visible": true,
                "sType": "html",
                "sWidth": "25px",
            },
            
            
        ],
    });
    table.column(4).visible(false);
	table.column(11).visible(false);
	//table.column(10).visible(false); //price
	table.column(12).visible(false); //decription
	//table.column(14).visible(false);
	table.column(13).visible(false); //Опис
	table.column(15).visible(false); //Інвентеризація
	
	$('#iTable_length').append('<div class="cdiv"><label> Тип:</label><input type="text" id="s_type" placeholder="Search type" /> </div>');    
	$('#iTable_length').append('<div class="cdiv"><label> Назва:</label><input type="text" id="s_name" placeholder="Search name" /></div>' );
{#	$("div.toolbar").html('<a class="toggle-vis" data-column="1">Id</a>, <a class="toggle-vis" data-column="2">Type</a>'); #}
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark" data-column="1">Id</a></div>');
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark " data-column="2">Тип</a></div>');
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark" data-column="3">Виробник</a></div>');
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark" data-column="4">Youtube</a></div>');	
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark" data-column="-5">Знижка</a></div>');
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark" data-column="-4">Сума</a></div>');	
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark" data-column="-3">Опис</a></div>');
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark" data-column="-2">Місце</a></div>');
	$('#iTable_length').append('<div class="cdiv"><a class="toggle-vis badge badge-dark" data-column="-1" id="show_inv" val="0">Інв.</a></div>');
	$('#iTable_length').append('<div class="cdiv"><a href="javascript:void(0);" id="show_hide" val="0" class="text-white badge badge-dark">Наявні</a></div>');
	$("#iTable_length").append('  <a href="javascript:void(0);" id="sel_all" class="badge badge-dark text-white" val="0">Виділити всі</a> ');
{% if request.user|has_group:"admin" %}
	$("#iTable_length").append(' <a href="javascript:void(0);" id="c_join" class="badge badge-dark text-white" val="0">Обєднати товари</a>');
	$("#iTable_length").append(' <a href="javascript:void(0);" id="sale_change" val="0" class="badge badge-dark text-white">Змінити знижку</a>');
{% endif %}	
	$("#iTable_length").append('  <a href="javascript:void(0);" id="print_phpbb" val="0" class="badge badge-dark text-white">TEXT</a>');
	$("#iTable_length").append('  <a href="javascript:void(0);" id="change_type" val="0" class="badge badge-dark text-white">Змінити категорію</a>');
	$("#iTable_length").append('  <a href="javascript:void(0);" id="add_param" val="0" class="badge badge-info text-white">Властивості</a>');
	$("#iTable_length").append('  <a href="javascript:void(0);" id="price_tag_button" val="0" class="badge badge-dark text-white">Цінники</a>');
	

 
    // Apply the search in add field
    $('#s_type').on( 'keyup change', function () {
    	table.column( 2 ).search( this.value ).draw();
    } );
    $('#s_name').on( 'keyup change', function () {
    	table.column( 6 ).search( this.value ).draw();
    } );
    
    $('a.toggle-vis').on( 'click', function (e) {
        e.preventDefault();
         // Get the column API object
        var column = table.column( $(this).attr('data-column') );
         // Toggle the visibility
        column.visible( ! column.visible() );
    } );

    $('[data-toggle="datepicker"]').datepicker({
        autoHide: true,
        zIndex: 2048,
        format: 'dd-mm-yyyy',
        daysMin: ['Нд', 'По', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
        monthsShort: ['Січ', 'Лют', 'Бер', 'Кві', 'Тра', 'Чер', 'Лип', 'Сер', 'Вер', 'Жов', 'Лис', 'Гру'],
        weekStart: 1,
      });   

    $(document).on("click", ".photoModalbutton", function(event) {    
//	$('.photoModalbutton').on('click', function (e) {
		$("#photo_url").attr("ids", $(this).attr('pk_catalog'));
		$('#photoModal').modal('toggle');  
		$.ajax({
            type: "POST",
            url: "/photo/url/get/",
            data: {id:  $(this).attr('pk_catalog') },
            dataType: "json",
            success:function(data){

            var st = JSON.stringify(data);
			var p = jQuery.parseJSON(st);
//			console.log("aData = " + data.aData.length);
			$(".carousel-inner").empty();
			$(".carousel-indicators").empty();
			
			if (data.aData.length > 0) {
					
				$("#exampleModalLongTitle").html("Фото - " + p.cname); //aData[0].id); 
					$.each(p.aData,function(index, item){
/*						var item_url
						if (item.url != null) {
							item_url = item.url
							console.log("ITEM_URL = " + item_url);
						}
						
						if (item.local != null) {
							item_url = item.local
							console.log("ITEM_URL_Local = " + item_url);
						}
	*/					
						
						if (index == 0){
							str_photo = '<div class="carousel-item active"><img id="image_' + index + '" src="'+ item + '" class="d-block w-100"></div>'
							str_indicator = '<li data-target="#carouselExampleIndicators" data-slide-to="' + index + '" class="active"></li>'
						}
						else {
							str_photo = '<div class="carousel-item"><img id="image_' + index + '" src="'+ item + '" class="d-block w-100"></div>'
							str_indicator = '<li data-target="#carouselExampleIndicators" data-slide-to="' + index + '"></li>'
						}
						$(".carousel-inner").append(str_photo);
						$(".carousel-indicators").append(str_indicator);
					})
				}
            },
            error:function(){
                alert("При відправці виникли проблеми");
            }
        });		
		
		});	    


 $('.photoAddbutton').on('click', function (e) {    
	 $('#photoModal').modal('toggle'); 
	 $("#dialog_photo_add").dialog("open");
	 //$("#photo_url").value = "";
 })


 $('.CatalogPhotoList').on('click', function (e) {    
	 var ids = $("#photo_url").attr("ids")
	 window.location.href='/catalog/'+ ids +'/photo/list/5/'
 })

 
 $("body").on('click', '#sel_all', function() {
	var status = $('#sel_all').attr('val')
	if ( status == 1) {
		$('#sel_all').attr('val', 0);
		$('#sel_all').html('Виділити всі');
		table.rows().deselect();
// 		table.draw();
	}
	if ( status == 0) {
		$('#sel_all').attr('val', 1);
		$('#sel_all').html('Зняти виділення');
		table.rows().select();
	}
 });

 $("body").on('click', '#show_hide', function() {
	var status = $('#show_hide').attr('val')
	if ( status == 1) {
		$('#show_hide').attr('val', 0);
		$('#show_hide').html('Наявні');
		$.fn.dataTableExt.afnFiltering.pop();				
 		table.draw();
	}
	if ( status == 0) {
		$('#show_hide').attr('val', 1);
		$('#show_hide').html('Всі');
		$.fn.dataTableExt.afnFiltering.push(
        function(oSettings, aData, iDataIndex) {
           //Only shows columns with a COUNT > 0
           var engineColumn = parseInt(aData[9]);
           if (engineColumn != 0)
               return true;
           return false;
        });
 		table.draw();
	}
 });

 	
 	$('#show_hide_1').on('click', function() {
 		$.fn.dataTableExt.afnFiltering.pop();
 		table.draw();
 	});
 	
 	$( "#m_combobox" ).combobox();
 	$( "#t_combobox" ).combobox();

{% ifequal focus 1%}
 	$('#m_combobox').next().find('input').focus();
{% endifequal %}
{% ifequal focus 2%}
 	$('#t_combobox').next().find('input').focus();
{% endifequal %} 	
{% ifequal focus 0%}
 	document.getElementById('s_name').focus();
{% endifequal %}  	

//---- inline edit ---
$("body").on("click",".price_edit",function(e){ 	    
// 	$('.price_edit').each(function() {
     $(this).editable('/catalog/edit/', {
  
     	 id   : 'id',
         name : 'price',
         data : function(value, settings) {
	     	var retval = value.split(" ")[0];
      	 	return retval;
      	 },
      
         submitdata : function() {
      	 	return {id : $(this).attr('id_price')};
    	 },
         indicator : 'Saving...',
         select : true,
         event : "dblclick",
         style : "inherit",
         callback : function(value, settings) {
         	$(this).html(value + " грн.");
     	 }
     });
    });


$("body").on("click",".sale_edit",function(e){ 	    
     $(this).editable('/catalog/edit/', {
     	 id   : 'id',
         name : 'sale',
         data : function(value, settings) {
	     	var retval = value.split(" ")[0];
      	 	return retval;
      	 },
      
         submitdata : function() {
      	 	return {id : $(this).parents('tr').attr('id')};
    	 },
         indicator : 'Saving...',
         select : true,
         event : "dblclick",
         style : "inherit",
         callback : function(value, settings) {
         	$(this).html(value + " %");
     	 }
     });
    });


$("body").on("click",".locality_edit",function(e){ 	    
//$('.locality_edit').each(function() {
  $(this).editable('/catalog/edit/', {
        loadurl : '/catalog/get/locality/',
     	loadtype: 'POST',
		loaddata : {sel_id: $(this).attr('id_locality')},     	
	   	 id   : 'id',
         name : 'locality',
         submitdata : function() {
      	 	return {id : $(this).attr('id_locality')};
    	 },
         indicator : 'Saving...',
         select : true,
         event : "dblclick",
         style : "inherit",
         tooltip   : 'dblClick to edit...',
         callback : function(value, settings) {
        	    $(this).html(value);
     	 }
 }).trigger("focus");    
});
 
 	
$("body").on("click",".edit_type",function(e){ 	
//$('.edit_type').each(function() {
	$(this).editable('/catalog/set/type/', {
     name: 'category_id',
	 loadurl : '/category/get/list/',
	 loaddata : function(value, settings) {
       return {sel: $(this).attr('cat_id')};
   	 },
     loadtype: 'POST',
     type   : 'select',
     submit : 'OK',
     tooltip   : 'Click to edit...',
     style   : 'inherit',
     event : "dblclick",
     submitdata : function() {
      	return {id : $(this).attr('id_type')};
    	 },
     callback : function(value, settings) {
//         console.log(this);
//         console.log(typeof(value));
//         console.log(settings);
         var obj = jQuery.parseJSON(value);
//         console.log(obj);
         $(this).attr('cat_id', obj[0]['type__id']);
         str1 = '<a href="/invoice/category/' + obj[0]['type__id'];
         str2 = '/view">' + obj[0]['type__name'] + "</a>";
         $(this).html(str1 + str2);
     }
    }).trigger("focus"); 
});


$("body").on("click",".td_desc",function(e){	
	//$("td[id_desc]").editable('/catalog/edit/', {
    $(this).editable('/catalog/edit/', {
         submitdata : function() {
      	 	return {id : $(this).attr('id_desc')};
    	 },         
         type      : 'textarea',
         cancel    : 'Cancel',
         submit    : 'OK',
         indicator : 'Saving',
         tooltip   : 'dbClick to edit...',
         style : "inherit",
         width: 150,
         height: 100,
		 event : "dblclick",         
     }).trigger("focus");
     });


$("#dialog").dialog({
	autoOpen: false,
      resizable: false,
      modal: true,
      buttons: {
        "Додати": function() {
			$.ajax({
                type: "POST",
                url: "/shop/price/print/add/",
                data: {
                	id:  $("#dtext").attr("ids"), 
                	scount: $('#spinner').val()
                	},
                dataType: "text",
                success:function(msg){
//                    alert("Все отлично ушло на сервер - " + msg);
//               	    $('#spinner').after('<p>ajax done</p>');
                },
                error:function(){
                    alert("При отправке возникли проблемы");
                }
            });

        
          $( this ).dialog( "close" );
        },
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      }
});


$("#dialog_catalog_join").dialog({
	autoOpen: false,
      resizable: false,
      modal: true,
      open: function( event, ui ) {
		$('#main_id').val("") //очищення поля

	  },
    
      buttons: {
        "Додати": function() {
				                        
//        	$("#dialog_catalog_join").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
        	
			$.ajax({
                type: "POST",
                url: "/catalog/join/",
                data: {id:  $("#main_id").val(), ids:  $("#jtext").attr("ids") },
                dataType: "text",
                success:function(msg){
                
                $("#dialog_catalog_join").dialog('widget').find("button:contains('Додати')").button("option", "disabled", true);
                if (msg != 'ok'){
                	alert("Помилка: " + msg);
                	$("#dialog_catalog_join").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                }
                if (msg == 'ok') {
                	$("#dialog_catalog_join").dialog("close");
                	$("#dialog_catalog_join").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                	var table = $('#iTable').DataTable();
                	var row_list = $("#jtext").attr("index").split(',');
                	row_list.splice( $.inArray($("#main_id").attr("index"), row_list), 1 );
                	/* for (index = row_list.length-1; index >= 0; --index) {
                		console.log("delete index = " + row_list[index])
                		table.row(row_list[index]).remove().draw(false);
                	} */
                	table.row(row_list).remove().draw();

                }
                },
                error:function(){
                    alert("При отправке возникли проблемы");
                },
       })
       },
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      } 
});


$("#dialog_change_type").dialog({
	autoOpen: false,
      resizable: false,
      modal: true,
      width: '80%',
      open: function( event, ui ) {
		$('#s_category').val(""); //очищення поля
		$("#sel_c").empty();
	  },
      buttons: {
        "Додати": function() {
        	
			$.ajax({
                type: "POST",
                url: "/catalog/set/type/",
                data: {category_id:  $("#s_category").attr('type_id'), ids:  $("#sel_c").attr("ids") },
                dataType: "text",
                success:function(msg){
                
                $("#dialog_change_sale").dialog('widget').find("button:contains('Додати')").button("option", "disabled", true);
                if (msg != 'ok'){
                	alert("Помилка: " + msg);
                	$("#dialog_change_sale").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                }
                if (msg == 'ok') {
                	$("#dialog_change_type").dialog("close");
                	$("#dialog_change_type").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                	var table = $('#iTable').DataTable();
                	var row_list = $("#sel_c").attr("index").split(',');
                	//row_list.splice( $.inArray($("#sale_p").attr("index"), row_list), 1 );
                	for (index = row_list.length-1; index >= 0; --index) {
                		console.log("change cell ["+ index +"] = " +  table.cell(row_list[index],10).data() );
                		table.cell(row_list[index],10).data($("#sel_c").val());
                	} 
                	//table.row(row_list).remove().draw();
                }
                },
                error:function(){
                    alert("При отправке возникли проблемы");
                },
       })
       },
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      } 
});


$("#dialog_add_param").dialog({
    autoOpen: false,
      resizable: false,
      modal: true,
      width: '80%',
      open: function( event, ui ) {
        $('#s_param').val(""); //очищення поля
        $("#sel_c_param").empty();
      },
      buttons: {
        "Додати": function() {
            
            $.ajax({
                type: "POST",
                url: "/catalog/add/attribute/",
                data: {attr_id:  $("#s_param").attr('attr_id'), ids:  $("#sel_c_param").attr("ids") },
//                dataType: "text",
                dataType: "json",
                success:function(data){
//                    var st = JSON.stringify(data);
//                    var p = jQuery.parseJSON(st);
//                    console.log('Data = ' + data);
 //                   console.log('JSON = ' + st + " | status " + st['status']);
 //                   console.log('P parse = ' + p + " | status " + p['status']);
                    console.log('JSON status >>> ' + data['msg']);
                    
                $("#dialog_add_param").dialog('widget').find("button:contains('Додати')").button("option", "disabled", true);
                if (data['status'] == false){
                    alert("Помилка: " + msg);
                    $("#dialog_add_param").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                }
                if (data['status'] == true) {
                    $("#dialog_add_param").dialog("close");
                    $("#dialog_add_param").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);

                    var table = $('#iTable').DataTable();
                    var row_list = $("#sel_c_param").attr("index").split(',');
                    //row_list.splice( $.inArray($("#sale_p").attr("index"), row_list), 1 );
                    for (index = row_list.length-1; index >= 0; --index) {
                        console.log("change cell ["+ index +"] = " +  table.cell(row_list[index],10).data() );
                        table.cell(row_list[index],10).data($("#sel_c").val());
                    } 
                    //table.row(row_list).remove().draw();
                }
                },
                error:function(){
                    alert("При відправці виникла помилка. Параметр msg - має невірне значення ");
                },
       })
       },
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      } 
});


$("#dialog_change_sale").dialog({
	autoOpen: false,
      resizable: false,
      modal: true,
      open: function( event, ui ) {
		$('#sale_p').val(""); //очищення поля
		$("#sel_c").empty();
	  },
      buttons: {
        "Додати": function() {
        	
			$.ajax({
                type: "POST",
                url: "/catalog/sale/edit/",
                data: {sale:  $("#sale_p").val(), ids:  $("#sale_p").attr("ids") },
                dataType: "text",
                success:function(msg){
                
                $("#dialog_change_sale").dialog('widget').find("button:contains('Додати')").button("option", "disabled", true);
                if (msg != 'ok'){
                	alert("Помилка: " + msg);
                	$("#dialog_change_sale").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                }
                if (msg == 'ok') {
                	$("#dialog_change_sale").dialog("close");
                	$("#dialog_change_sale").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                	var table = $('#iTable').DataTable();
                	var row_list = $("#sale_p").attr("index").split(',');
                	//row_list.splice( $.inArray($("#sale_p").attr("index"), row_list), 1 );
                	for (index = row_list.length-1; index >= 0; --index) {
                		console.log("change cell ["+ index +"] = " +  table.cell(row_list[index],10).data() );
                		table.cell(row_list[index],10).data($("#sale_p").val());
                	} 
                	//table.row(row_list).remove().draw();

                }
                },
                error:function(){
                    alert("При отправке возникли проблемы");
                },
       })
       },
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      } 
});


$("#dialog_b_buy").dialog({
	autoOpen: false,
      resizable: false,
      modal: true,
      open: function( event, ui ) {
		$('#buy_p').val(""); //очищення поля
	  },
      buttons: {
        "Додати": function() {
        	
			$.ajax({
                type: "POST",
                url: "/client/invoice/add/",
                data: {count:  $("#count_s").val(), ids:  $("#dialog_b_buy").attr("ids") },
                dataType: "text",
                success:function(msg){
                
                $("#dialog_b_buy").dialog('widget').find("button:contains('Додати')").button("option", "disabled", true);
                if (msg != 'ok'){
                	alert("Помилка: " + msg);
                	$("#dialog_b_buy").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                }
                if (msg == 'ok') {
                	$("#dialog_b_buy").dialog("close");
                	$("#dialog_b_buy").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);

                }
                },
                error:function(){
                    alert("При отправке возникли проблемы");
                },
       })
       },
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      } 
});


$("#dialog_photo").dialog({
	autoOpen: false,
      resizable: true,
      modal: true,
      width: 540,
//      maxWidth: 540,
      //position: "center",
      buttons: {
        "Видалити": {
        	id: "delete_p",
        	text: "Видалити",
        	click: function(){
        	if (confirm("Ви дійсно бажаєте видалити запис?")) {
        		// $("#slider1_container").remove();
			$.ajax({
                type: "POST",
                url: "/catalog/photo/delete/",
                data: {id:  $("#delete_p").attr("pk") },
                dataType: "text",
                success:function(data){
                	console.log("Видалено");
                	$("#dialog_photo").dialog( "close" );
                },
                error:function(data){
                    alert("Виникли проблеми з сервером" + data);
                }
            });        		
        		
        	}
        	},
        },
        "Додати": function() {
        	$("#dialog_photo_add").dialog("open");
          $( this ).dialog( "close" );
        },
        "Відмінити": function() {
        	$("#slider1_container").remove();
        	$( this ).dialog( "close" );
        },
      },
      close: function( event, ui ) {
      	//$("#dialog_photo .slideme ul").remove();
      	$("#slider1_container").remove();
      }
});


$("#dialog_inventory").dialog({
	closeOnEscape: true, 
	autoOpen: false,
      resizable: false,
      modal: true,
      width: 600,
      maxWidth: 700,
//      minWidth: 500,
      //position: "center",
      buttons: {
        "Додати": function() {
//        	on_off_button(true);
        	$("#dialog_inventory").dialog('widget').find("button:contains('Додати')").button("option", "disabled", true);
			$.ajax({
                type: "POST",
                url: "/inventory/add/",
                data: {id:  $("#dialog_inventory").attr("ids"), count: $('#inv_spinner').val(), desc: $('#inv_desc').val(), status: document.getElementById("chk_all").checked },
//                dataType: "text",
                dataType: "json",
                success:function(value){

                var st = JSON.stringify(value);
				var p = jQuery.parseJSON(st);
                
                if (p.status == "error") {
                	// alert("Введіть текст опису");
                	alert(p.message);
//                	on_off_button(false);
                	$("#dialog_inventory").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
					}
				else {
				
					var fcol = '<abbr title="' + p.user__username + '">' + p.date + '</abbr>';
					var cdesc = p.description;
					var tr_cls = "";
					if (p.check_all) {
						tr_cls = '<tr class="table-success" cid="">';
					}
					else {
						tr_cls = '<tr class="table-info" cid="">';
					}
					var count = '<td style="background-color:#c0c5ce">' + p.count + 'шт.';
                	$('#table_body').append(tr_cls+ '<td>'+ fcol +'</td><td>'+ cdesc +'</td>' + count +'</td><td>'+ p.check_all +'</td><td>' + p.real_count +' шт.</td></tr>');				
   					$( "#table_body" ).append( "<tr class='table-info'><td>Підрахунок додано!</td></tr>");
					$("#dialog_inventory").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);				
					
				}
                },
                error:function(){
                    alert("При відправці виникли проблеми");
//                    on_off_button(false);
                    $("#dialog_inventory").dialog('widget').find("button:contains('Додати')").button("option", "disabled", false);
                    
                }
            });        
        },
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      }
});


$("#dialog_photo_add").dialog({
	autoOpen: false,
      resizable: true,
      modal: true,
      //position: "center",
      width: 650,
      buttons: {
        "Додати": function() {
			$.ajax({
                type: "POST",
                url: "/photo/url/add/",
                data: {id:  $("#photo_url").attr("ids"), url: $('#photo_url').val()},
                dataType: "text",
                success:function(value){
                //	var obj = jQuery.parseJSON(value);
                //	document.getElementById("link_1197").setAttribute("url", "TEST");
                if (value != "ok") {
                	//alert(value);
                	$("#dialog_photo").dialog({title: value });
                	if ($("#img_url").attr('width') > 500) {
                		$("#img_url").attr({'src' : $('#photo_url').val()}, {'width': "500 px"});
                	}
                	else {
                		$("#img_url").attr({'src' : $('#photo_url').val()});
                	}
                	
                	$("#dialog_photo").dialog({ buttons: [ { text: "Ok", click: function() { $("#dialog_photo").dialog( "close" ); } }, {text: "Cancel", click: function() {$("#dialog_photo").dialog("close"); }} ] });
//                	$("#dialog_photo").dialog({ position: { my: "center top", at: "center top", of: window } });
					$("#dialog_photo").dialog("open");
					//$("#dialog_photo").dialog("moveToTop");
					$("#ui-id-2").attr({"color": '#fe011b'});
					
					}
					var photo_id = $("#photo_url").attr("ids"); 
					$("#link_"+photo_id).attr("src", "/media/images/photo_ico_true.png");
                },
                error:function(){
                    alert("При отправке возникли проблемы");
                }
            });
        
          $( this ).dialog( "close" );
        },
        "Відмінити": function() {
          $( this ).dialog( "close" );
          
        }
      }
});

$("#dialog_youtube_add").dialog({
	autoOpen: false,
      resizable: true,
      modal: true,
      //position: "center",
      width: 650,
      buttons: {
        "Додати": function() {
			$.ajax({
                type: "POST",
                url: "/youtube/add/",
                data: { upload_youtube: $('#youtube_url').val(), c_id: $("#dialog_youtube_add").attr("ids")},
                dataType: "text",
                success:function(value){
                if (value != "ok") {
                	//alert(value);
                	$("#dialog_photo").dialog({title: value });
                	if ($("#img_url").attr('width') > 500) {
                		$("#img_url").attr({'src' : $('#youtube_url').val()}, {'width': "500 px"});
                	}
                	else {
                		$("#img_url").attr({'src' : $('#youtube_url').val()});
                	}
                	
//                	$("#dialog_photo").dialog({ buttons: [ { text: "Ok", click: function() { $("#dialog_photo").dialog( "close" ); } }, {text: "Cancel", click: function() {$("#dialog_photo").dialog("close"); }} ] });
//                	$("#dialog_photo").dialog({ position: { my: "center top", at: "center top", of: window } });
//					$("#dialog_youtube_add").dialog("open");
					$("#ui-id-2").attr({"color": '#fe011b'});
				}
					//var youtube_id = $("#youtube_url").attr("ids"); 
					var youtube_id = $("#dialog_youtube_add").attr("ids")
					$("#link_"+youtube_id).attr("src", "/media/images/photo_ico_true.png");
                },
                error:function(){
                    alert("При отправке возникли проблемы");
                }
            });
		  $('#youtube_url').val()
          $( this ).dialog( "close" );
        },
        "Відмінити": function() {
          $( this ).dialog( "close" );
          
        }
      }
});

$("#dialog_print").dialog({
	autoOpen: false,
      resizable: true,
      width: 750,
      modal: true,
      open: function( event, ui ) {
		console.log("Table width = " +  $("#print_container").find("table").width() ); //очищення поля
//		$("#dialog_print").dialog( "option", "width", $("#dialog_print").find("table").width() );
	  },
      buttons: {
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      }
});


$("#dialog_edit_email").dialog({
	autoOpen: false,
      resizable: true,
      width: 400,
      modal: true,
      open: function( event, ui ) {
//		console.log("Table width = " +  $("#print_container").find("table").width() ); //очищення поля
//		$("#dialog_print").dialog( "option", "width", $("#dialog_print").find("table").width() );
	  },
      buttons: {
        "Надіслати": function() {
          $( this ).dialog( "close" );
          $(this).trigger('confirm');
        }, 
        "Відмінити": function() {
          $( this ).dialog( "close" );
          $(this).trigger('cancel');
        }, 
        
      }
});



function box_element(box_name, box_desc, shop, count, box_id) {
    var ins_dom = ''; 
    var counters = '';
    counters = '<span class="click_count badge badge-secondary ml-2 mr-2" ">1</span><span class="click_count badge badge-secondary mr-2">2</span><span class="click_count badge badge-secondary mr-2">3</span><span class="click_count badge badge-secondary mr-2">5</span><span class="click_count badge badge-secondary mr-2">10</span>'
    ins_dom = '<div class="box_block"><h2> <span class="badge badge-primary">' + box_name + '</span> - ' + box_desc + ' ['+ shop +'] </h2>' +
        '<label for="spinner_addcount">Кількість:</label>' +
        '<input class="spinner_addcount ml-2 w-50" box_id="'+ box_id +'" name="value" value="0" type="number" min=0 max="'+ count +'" >' +counters+ '</div> <hr>';
return ins_dom;
};

$("#dialog_addboxname").dialog({
    autoOpen: false,
      resizable: true,
      width: resize_dialog_width(1024),
      modal: true,
      open: function( event, ui ) {
          $('#dialog_addboxname').find('.box_container').empty()
//          console.log("ITEM id = " + $("#dtext_item").attr("ids") );
          $.ajax({
              type: "POST",
               url: "/client/invoice/get/boxes/",
               data: { cat_id_only:  $("#dtext_item").attr("ids") },  
               dataType: "json",
              success:function(data){
               if (data['status'] == true){
                   for (let i = 0; i < data['boxes'].length; i++ ) {
                       var b_name = data['boxes'][i].name['box_name'];
                       var box_desc = data['boxes'][i].name['box_desc']
                       var shop_n = data['boxes'][i].name['box_shop']
                       var b_count = data['boxes'][i].name['count']
                       var box_id = data['boxes'][i].name['box_id']
                       $('#dialog_addboxname').find('div.box_container').append(box_element(b_name, box_desc, shop_n, b_count, box_id));
//                       console.log("Box ["+ i +"] = " + data['boxes'][i]);
                   }
               }
               else {
                  alert("Помилка: " + data['boxes']);
               }
              },
              error:function(msg){
                  alert("При відправці виникла помилка:\n " + msg.responseJSON['reason']);
              }
           });
      },      
      buttons: {
        "Додати": function() {
            arr_res = []
            for ( let j=0; j < $(".spinner_addcount").length; j++ ) {
//                console.log("BoxId - " + $('.spinner_addcount')[j].getAttribute('box_id'));
//                console.log("Box_count - " + $('.spinner_addcount')[j].value );
                var boxid = $('.spinner_addcount')[j].getAttribute('box_id');
                var box_count = $('.spinner_addcount')[j].value;
                var box = {'boxid': boxid, 'count': box_count};
                arr_res.push(box); 
            }
            for (let i=0; i < arr_res.length; i++){
               json_data = {
                       id: $("#dtext_item").attr("ids"),
                       box_id: arr_res[i].boxid,
                       count: arr_res[i].count,
                       status: true 
                   };
               if (arr_res[i].count > 0) {
            $.ajax({
                type: "POST",
                url: "/inventory/add/",
                dataType: "json",
                data: JSON.stringify(json_data),
                contentType: "application/json; charset=utf-8",
                success: function(data){
                    //var jsd = jQuery.parseJSON(data);
                    console.log("Data response = " + data['sb_boxname']);
                    if (data['status']=="done"){
                    	alert("Запит надіслано успішно. Додано +" + data['count'] + " шт. в ящик " + data['sb_boxname']);
                    };
                    //alert("Запит надіслано успішно. \nCLI_INV_id = " + ciid);
                    //$("tr[ci_id=" + ciid +" ]").hide();
//                    $("tr[ci_id=" + ciid +" ]").find("td.ci_desc").empty();
/*                    for (let i=0; i < data['boxes'].length; i++){
                        var tmp_name = data['boxes'][i].name;
                        $("tr[ci_id=" + ciid +" ]").find("td.ci_desc").append("<p class='mb-1' style='font-size: smaller;'>" + tmp_name + "</p>");
                    };*/
                },
                error: function(msg){
                    alert("При відправці виникла помилка:\n " + msg.responseJSON['reason']);
                }
            });
               }
            };
            
          $( this ).dialog( "close" );
        },
        "Відмінити": function() {
          $( this ).dialog( "close" );
        }
      }
});


$(document).on("click", ".addboxname", function(event) {
    console.log("Click is Work! ID = " + $(this).parents('tr').attr('id'));	
    $("#dtext_item").attr({"ids": $(this).parents('tr').attr('id')});
    $("#dialog_addboxname").dialog("open");
    $("#catalog_name").remove();
    $("#dtext_item").append("<span id='catalog_name'>" + $(this).parents('tr').find('td.c_name').attr('data-name') + "</span><hr>");
//    $("#dtext_item").append("<div class='row' id='catalog_name'><div class='col'>" + $(this).parents('tr').find('td.c_name').html() + "</div></div><hr>");
  //  catalog_item
});


$("body").on('click', '.click_count', function() {
    var num = $(this).parents('div.box_block');
    console.log("SPIN val = " + num.children('.spinner_addcount').val() );
    console.dir($(this));
    console.log("click on - " + $(this).html());
    num.children('.spinner_addcount').val($(this).html());
});


}); //end Ready function



$(document).on("click", ".c_youtube", function(event) {
//	console.log("IDs = " + $(this).attr('ids'));
//	console.log("YOUtube ID = " + $(this).parent('td').attr('youtube_id'));
	$("#dialog_youtube_add").attr('ids', $(this).attr('ids'));
	var t = $("#td_"+$(this).attr('ids')).nextAll(".c_name:first").html();
	$("#cat_name_youtube").html(t);
	if ( $(this).parent('td').attr('youtube_id') != 'None'){
	$.ajax({
        type: "POST",
        url: "/youtube/url/get/",
        data: {youtube_id:  $(this).parent('td').attr('youtube_id') },
        dataType: "json",
        success:function(data){
        	$("#youtube_content").empty();
        	var st = JSON.stringify(data);
			var p = jQuery.parseJSON(st);
//			console.log("YOUtube url = " + p.yData);
        	add_str = '<iframe width="100%" height="305" src="https://www.youtube.com/embed/'+ p.yData +'" frameborder="0" allow="encrypted-media" allowfullscreen></iframe>'
        	$("#youtube_content").append(add_str);    	
        },
        error:function(){
            alert("При відправці виникли проблеми");
        }
	});	
	}
	
	$("#dialog_youtube_add").dialog('open');
});

$(document).on("click", ".c_photo", function(event) {
	   		//var t = $("#td_"+$(this).attr('ids')).nextAll(".c_name:first").html();
	   		console.log('T = '+ t);
	   		var t = '';
    		$("#dialog_photo_add").dialog({title:  t});
			$.ajax({
                type: "POST",
                url: "/photo/url/get/",
                data: {id:  $(this).attr('ids') },
                dataType: "json",
                success:function(data){

                var st = JSON.stringify(data);
				var p = jQuery.parseJSON(st);
				if (data.aData.length > 0) {
						
						$("#delete_p").attr("pk", p.aData[0].id); 
						
						str_begin = '<div id="slider1_container" style="position: relative; top: 0px; left: 0px; width: 600px; height: 400px;">';
						str_begin = str_begin + '<div u="slides" style="cursor: move; position: absolute; overflow: hidden; left: 0px; top: 0px; width: 600px; height: 400px;">';
						str_end = '</div></div>';
						$("#dialog_photo").append(str_begin);
						
						$.each(p.aData,function(index,item){
							str_photo = '<div><img id="image_' + index + '" src="'+ item.url+ '" width="350px" pk="'+ item.id +'"></di>'
							$("#slider1_container > div").append(str_photo);
						})
						
						$("#dialog_photo").append(str_end);
						

str_narrow = ' <span u="arrowleft" class="jssora03l" style="top: 123px; left: 8px;">'+
        '</span>'+
        '<!-- Arrow Right -->'+
        '<span u="arrowright" class="jssora03r" style="top: 123px; right: 75px;">'+
        '</span>';
				$("#slider1_container > div").append(str_narrow);

    
str_navi = '<div u="navigator" class="jssorb01" style="bottom: 16px; left: 10px;">'+
            '<!-- bullet navigator item prototype -->'+
            '<div u="prototype"></div>'+
        '</div>';
        
						$("#slider1_container > div").append(str_navi);						

						
 //var options = {};
 var options = {
 			$ArrowNavigatorOptions: {
                $Class: $JssorArrowNavigator$,
                $ChanceToShow: 2
            },
            $BulletNavigatorOptions: {
                $Class: $JssorBulletNavigator$,
                $ChanceToShow: 2
            },
            $DragOrientation: 3 
        };
 var jssor_slider1 = new $JssorSlider$('slider1_container', options);
 
 function SlideParkEventHandler(slideIndex, fromIndex) {
            var src = $("#image_" + slideIndex).attr("src");
            console.log("CUR SRC = " + src);
            var id = $("#image_" + slideIndex).attr("pk");
            console.log("Photo Id = " + id);
        }

 jssor_slider1.$On($JssorSlider$.$EVT_PARK, SlideParkEventHandler);
						
						$("#dialog_photo").dialog({ title: p.cname });
					    $("#dialog_photo").dialog("open");
					    $("#dialog_photo_add").dialog({ title: p.cname });
					    $("#photo_url").attr({'ids': p.id});
					}
					else {
				   		$("#photo_url").attr({'ids': p.id});
				   		$("#dialog_photo_add").dialog({ title: p.cname });
   						$("#dialog_photo_add").dialog("open");
   						$("#photo_url").select();
					}   					
                },
                error:function(){
                    alert("При відправці виникли проблеми");
                }
            });
});



$(document).on("click", ".inv_td", function(event) {
	   	var t = $(this).attr('cap')
    	$("#dialog_inventory").dialog({title:  t});
    	$("#dialog_inventory").attr({'ids': $(this).parents('tr').attr('id')});
    	$("#inv_spinner").spinner();
    	$("#inv_spinner").val(1);
    	$("#inv_spinner").focus();
    	$("#inv_desc").val("");
    	document.getElementById("chk_all").checked = false;
    	$('#table_body').empty()
//    	on_off_button(false);
		$("#dialog_inventory").dialog("open");
		
		var Id = $(this).parents('tr').attr('id');
            $.ajax({
                type: "POST",
                url: "/inventory/get/",
                data: { catalog_id: Id },
                dataType: "json",
                success:function(msg){
                	$.each(msg,function(index,item){
    					var fcol = ' data-toggle="tooltip" data-html="true" data-placement="left" title="' + item['user__username'] + '">' + item['date'];
    					var cdesc = item['description'];
    					var tr_cls = "";
    					if (item['check_all']) {
    						var class_str = 'class="table-success"'
    							if (item['count'] > item['real_count']) {
    								class_str = 'class="table-yellow"'	
    							} 
    							if (item['count'] < item['real_count']) {
    								class_str = 'class="table-warning"'	
    							} 
    						tr_cls = '<tr ' + class_str +  ' cid="' + item['id'] + '" ' +' iyear="'+ item['date_year'] +'">';
    					}
    					else {
    						tr_cls = '<tr class="" cid="' + item['id'] + '" ' +' iyear="'+ item['date_year'] +'">';
    					} 
    					var count = '<td style="font-weight: bold; text-align: center;"><abbr title="' + item['edit_date'] + '">' + item['count'] + 'шт.</abbr>';
    					var status = ''
        					if (item['check_all']){
            						status = "Повністю"	
            					}
            					else{
            						status = "Частково"
            					}
    					
    {% if request.user|has_group:"admin" %}						
                	    $('#table_body').append(tr_cls+ '<td '+ fcol +'</td><td>'+ cdesc +'</td>' + count +'</td><td class="inv_set" style="cursor: pointer;">'+ status +'</td><td>'+item['real_count']+' шт.</td><td data-toggle="tooltip" data-html="true" data-placement="top" title="Видалити"><span class="inv_del" inv_id="'+item['id']+'" style="cursor: pointer;"><i class="material-icons">delete_outline</i></span></td>></tr>');
    {% else %}                	    
                	    $('#table_body').append(tr_cls+ '<td '+ fcol +'</td><td>'+ cdesc +'</td>' + count +'</td><td>'+ status +'</td><td>'+item['real_count']+' шт.</td></tr>');
    {% endif %}
                    });
                	$( "#table_body").find( "tr:not([iyear*='{{cur_year}}'])" ).hide();			
                },                
                error:function(msg){
                    alert(msg.responseText);
                }
            });      
});


$(document).on("click", ".inv_del", function(event) {
 if (confirm("Ви дійсно бажаєте видалити запис?")) {
 	console.log($(this).parents("tr"));
 	var tr_del = $(this).parents("tr");
	
		$.ajax({
                type: "POST",
                url: "/inventory/delete/",
                data: {id:  $(this).attr("inv_id") },
                dataType: "text",
                success:function(data){
                	console.log("ajax work");
                	tr_del.remove();
                	console.log($(this).parents("tr"));
                },
                error:function(data){
                    alert("Виникли проблеми з сервером" + data);
                }
            });	
 }
 });
 
//$(".inv_set").click(function(){
$("body").on('click', '.inv_set', function() {
	if (confirm("Ви дійсно бажаєте змінити статус?")) {
//	 	console.log("Attr = "  + $(this).parents("tr").attr("cid"));
	 	var tr_set = $(this).parents("tr");
	 	var td_set = $(this);
		
			$.ajax({
	                type: "POST",
	                url: "/inventory/set/",
	                data: {id:  $(this).parents("tr").attr("cid"), status: true },
	                dataType: "text",
	                success:function(data){
	     //           	console.log("ajax work = " + tr_set.html());
	                	tr_set.css('background-color','#7be58a'); /*.attr("background", "#7be58a");*/
	                	 
/*	                	var now = new Date(); 
	  					var datetime = now.getDate()+'/'+(now.getMonth()+1)+'/'+now.getFullYear(); 
	  					datetime += ' '+addZero(now.getHours())+':'+addZero(now.getMinutes())+':'+addZero(now.getSeconds());
	*/  					
	  					td_set.html('Змінено = ' + data); 
	  					td_set.css('background-color','#7be58a'); /*closest("td").prev().html(datetime);*/
	                },
	                error:function(data){
	                    alert("Виникли проблеми з сервером" + data);
	                }
	            });	
	 }
}); 


$("body").on('click', '.addprice', function() {
//$(document).on("click", ".addprice", function(event) {
//    $("#dtext").html($(this).attr('href'));
//	console.log("JUST WORK")
	$("#dtext").html('<b>Додати цінник до черги друку: >>></b>');
//    $("#dtext").attr({"ids": $(this).attr('ids')});
	var spinner = $("#spinner").spinner();
	$("#spinner").val(1);       
    $("#dialog").dialog("open");

	var table = $('#iTable').DataTable();
    var ids = []
	table.rows({ selected: true }).eq( 0 ).each( function (idx) {
//		console.log("index = " + idx +" / " + $(table.row( idx ).node()).attr('id') );
		ids.push( $(table.row( idx ).node()).attr('id') );
		$("#dtext").append("<br>" + table.cell( idx,6 ).data());
	});
//	$("#dtext").append("<br>ROW = " + ids)
	$("#dtext").attr({"ids": ids});

});


$("body").on('click', '#print_phpbb', function() {

	var table = $('#iTable').DataTable();
    var ids = []
	table.rows({ selected: true }).eq( 0 ).each( function (idx) {
//		console.log("index = " + idx +" / " + $(table.row( idx ).node()).attr('id') );
		ids.push( $(table.row( idx ).node()).attr('id') );
	});
	$.post( "/invoice/print/forum/", { ids: ids.join() } )
	.done(function( data ) {
//    alert( "Data Loaded: " + data );
		//data = data.replace(/</g, "[");
		//data = data.replace(/>/g, "]");
		//data = data.replace(/\n/g, "<br>");
		data_plaintext = data
		data = data.replace(/\n/g, "<br>");
//		console.log("replace = " + data );	
    $("#dialog_print").dialog("open");
    $("#print_container").html(data);
    document.getElementById("copyTarget").value = data_plaintext
  	});

});


$("body").on('click', '#change_type', function() {
    $("#dialog_change_type").dialog("open");
	var table = $('#iTable').DataTable();
    var ids = []
    var index = []

 // get some cells using a css class name:
    var someSelectedCells = table.cells(".c_name").data();
    for (var i = 0; i < someSelectedCells.length; i++) {
//      console.log("cname SOME = " + someSelectedCells[i]);
    }
    
    table.rows({ selected: true }).eq( 0 ).each( function (idx) {
		//var row_sel = $(table.row( idx ).node())[0];

		console.log('Cell one  = ' + table.cell( idx, 6 ).data());
//	table.cells().eq(0).each( function ( index ) {
	table.cells(idx).every( function ( index ) {
	    var data = this.data();
	    console.log('Data = ' + data);
	    console.log('Data NODE = ' + this.cell.node());
    // ... do something with data(), or cell.node(), etc
    } );
		console.log("IDX = " + idx);
		var row_sel = $(table.row( idx ));
		console.dir( table.row(idx) ); //.cells(idx, ".c_name") );
		console.log("ROW sel Class cname = " + table.row(idx).cells(idx, ".c_name").data() );
		
		for (const col in ($(table.row( idx ).node())[0].cells)) { // table.row( idx ).node())[0]){ // $(table.row( idx )[0].cells)){
			console.log("COL val = " + col);
		}
		
		console.dir(table.row( idx ).node().cells);
		console.log( "Row select = " + table.row( idx ).node().cells.item(0) ); // [].namedItem("td.c_name") ); //.namedItem("c_name") - name or id search );
	    
		// JQuery method
	    var jqf_col = $('tr#'+$(table.row( idx ).node()).attr('id')).find('td.c_name');
	    console.dir(jqf_col);
		console.log("JQuery find = " +  jqf_col[0].innerText); // nodeName. .find(".c_name:first");
		
		//console.log("Node = " + row_sel.cells[3].innerText ); // nodeName. .find(".c_name:first");
		//.find(".c_name:first")		
		console.log( "C-name = " + $(table.row( idx ).node())[0] );		
		console.dir($(table.row( idx ).node())[0] );
		console.dir($(table.row( idx ).node())[0].cells );
		for (var i=0; i < $(table.row( idx ).node())[0].cells.length; i++){
			console.log("FORloop by COL in sel ROW  = " + table.cell(idx, i+1).data());
			console.log("FORloop innerText  = " + table.cell(idx, i+1).node().className ); //innerText
			console.dir(table.cell(idx, i+1));
		}
			// $("#td_"+$(this).attr('ids')).nextAll(".c_name:first").html(); 		
		console.log("index = " + idx +" / " + $(table.row( idx ).node()).attr('id') + " - " + table.cell( idx,6 ).data() ); //typeof(table.cell( idx,6 ).data()) );
		ids.push( $(table.row( idx ).node()).attr('id') );
		index.push( idx );
		$("#sel_c").append("<br>[<mark class='mark_id' indx='"+idx+"'>" + $(table.row( idx ).node()).attr('id') +"</mark>]"+ "  " + jqf_col[0].innerText + table.cell( idx,5 ).data() ); //$(table.row( idx ).node())[0].innerText);
	});
	$("#sel_c").attr({"ids": ids});
	$("#sel_c").attr({"index": index});
	

	$( "#s_category" ).autocomplete({
		source: function( request, response ) {
	    	$.ajax({
	            type: "POST",
	            url: "/category/lookup/",
				data: { query: $("#s_category").val() },
	            dataType: "json",
	            success: function( data ) {
	                    	response( $.map( data, function( item ) {
	                        return {
	                            label: item.pk + ": " + item.fields.name + " / "+ item.fields.name_ukr,
	                            value: item.fields.name,
	                            pk_id: item.pk                                
								}
	                    	}));                                
	                        }
	        })
	    },
	    minLength: 3,
	    select: function( event, ui ) {
	    	console.log("Type ID = " + ui.item.pk_id);
	    	$('#s_category').attr('type_id', ui.item.pk_id);
	    },
	    open: function() {
	    	$( this ).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
	    },
	    close: function() {
	    	$( this ).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
	    }
	});
	
	
});

$("body").on('click', '#add_param', function() {
    $("#dialog_add_param").dialog("open");
    var table = $('#iTable').DataTable();
    var ids = []
    var index = []
    var type_ids = []
    
    table.rows({ selected: true }).eq( 0 ).each( function (idx) {
        //var row_sel = $(table.row( idx ).node())[0];

        // JQuery method
        var jqf_col = $('tr#'+$(table.row( idx ).node()).attr('id')).find('td.c_name');
        var jqf_col_type = $('tr#'+$(table.row( idx ).node()).attr('id')).find('td.edit_type');
        console.dir(table.cell( idx, 3 ).node());
        console.log("JQuery find = " +  jqf_col[0].innerText + " | " +   table.cell( idx, 2 ).node().getAttribute('cat_id') );//jqf_col_type[0].innerText); // nodeName. .find(".c_name:first"); getAttribute('id_type')
        
        
/*         console.log('Cell one  = ' + table.cell( idx, 6 ).data()); // dont change col number after show/hide columns in table
        console.log("IDX [sel row num] = " + idx);
        var row_sel = $(table.row( idx ));
        console.dir( table.row() ); //.row(idx) ); //.cells(idx, ".c_name") );
        console.log("ROW sel Class cname = " + table.row(idx).data()); //cells("c_name").data() );
        
        console.dir(table.row( idx ).node().cells);
        
        for (let item in table.row( idx ).node().cells)  {
            //var data = this.data();
            console.log("EVERY = " + item);
            // ... do something with data(), or this.node(), etc
        };
        		
               
        console.log( "C-name = " + $(table.row( idx ).node())[0] );     
        console.dir($(table.row( idx ).node())[0] );
        console.dir($(table.row( idx ).node())[0].cells );

        for (var i=0; i < $(table.row( idx ).node())[0].cells.length; i++){
            console.log("FORloop by COL in sel ROW  = " + table.cell(idx, i+1).data());
            console.log("FORloop innerText  = " + table.cell(idx, i+1).node() ); //innerText
            console.dir(table.cell(idx, i+1));
        }
 */        
       
        console.log("index = " + idx +" / " + $(table.row( idx ).node()).attr('id')); // + " - " + table.cell( idx,6 ).data() ); //typeof(table.cell( idx,6 ).data()) );
        ids.push( $(table.row( idx ).node()).attr('id') );
        index.push( idx );
        type_ids.push( jqf_col_type );
        $("#s_param").attr('type_id', table.cell( idx, 2 ).node().getAttribute('cat_id'));
        $("#sel_c_param").append("<br>[<mark class='mark_id' indx='"+idx+"'>" + $(table.row( idx ).node()).attr('id') +"</mark>]"+ "  " + jqf_col[0].innerText + table.cell( idx,5 ).data() ); //$(table.row( idx ).node())[0].innerText);
    });
    $("#sel_c_param").attr({"ids": ids});
    $("#sel_c_param").attr({"index": index});
    

    $( "#s_param" ).autocomplete({
        source: function( request, response ) {
            $.ajax({
                type: "POST",
                url: "/catalog/attribute/lookup/",
                data: { query: $("#s_param").val(), type: $("#s_param").attr('type_id') }, //$("#s_param").attr('type_id') },
                dataType: "json",
                success: function( data ) {
//                    console.log("Data[attr_name] = " + data['attr_name']);
                    //var dp = JSON.parse(data['data'])
                    var dp = data['data']
                    for (const j in data){
                    	console.log("HAsh = " + data[j]);
                    };
                    response( $.map( dp, function( item ) {
                    	   console.log("data map = " + item);                                            	
                            return {
                                //label: data['attr_name'] + " >>> " + item.pk + ": " + item.fields.value + " / "+ item.fields.value_float + " | " + item.fields.description ,
                                label: item['attr_name'] + " >>> " + item.id + ": " + item.value + " / "+ item.value_float + " | " + item.description ,
                                value: item.value,
                                pk_id: item.id                                
                                }
                            }));                                
                            }
            })
        },
        minLength: 3,
        select: function( event, ui ) {
//            console.log("Type ID = " + ui.item.pk_id);
            $('#s_param').attr('attr_id', ui.item.pk_id);
        },
        open: function() {
            $( this ).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
        },
        close: function() {
            $( this ).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
        }
    });
    
    
});

$("body").on('click', '#c_join', function() {
	$("#jtext").html('<b>Обєднати товари:</b>');
    $("#dialog_catalog_join").dialog("open");

	var table = $('#iTable').DataTable();
    var ids = []
    var index = []
	table.rows({ selected: true }).eq( 0 ).each( function (idx) {
		console.log("index = " + idx +" / " + $(table.row( idx ).node()).attr('id') );
		ids.push( $(table.row( idx ).node()).attr('id') );
		index.push( idx );
		$("#jtext").append("<br>[<mark class='mark_id' indx='"+idx+"'>" + $(table.row( idx ).node()).attr('id') +"</mark>]"+ table.cell( idx,5 ).data());
	});
	$("#jtext").attr({"ids": ids});
	$("#jtext").attr({"index": index});

});


$("body").on('click', '.mark_id', function() {
//	console.log("Click on: " +  $(this).text() );
	$("#main_id").val($(this).text());
	$("#main_id").attr('index', $(this).attr('indx'));
})


$("body").on('click', '.sale_td_url', function() {
	console.log("Click on: " +  $(this).text() );
	var tag_a = $(this).find('a');
	console.log("Click on: " +  tag_a.attr("href"));
	window.location.href = tag_a.attr("href");
//	$("#main_id").attr('index', $(this).attr('indx'));
})



$("body").on('click', '#sale_change', function() {
	$("#sale_c").html('<b>Обєднати товари:</b>');
    $("#dialog_change_sale").dialog("open");

	var table = $('#iTable').DataTable();
    var ids = []
    var index = []
	table.rows({ selected: true }).eq( 0 ).each( function (idx) {
		console.log("index = " + idx +" / " + $(table.row( idx ).node()).attr('id') );
		ids.push( $(table.row( idx ).node()).attr('id') );
		index.push( idx );
		$("#sel_c").append("<br>[<mark class='mark_id' indx='"+idx+"'>" + $(table.row( idx ).node()).attr('id') +"</mark>]"+ table.cell( idx,5 ).data());
	});
	$("#sale_p").attr({"ids": ids});
	$("#sale_p").attr({"index": index});

});


$("body").on('click', '#b_buy', function() {
	$("#buy_c").html('<b>Продати товари:</b>');
    $("#dialog_b_buy").dialog("open");
    var spinner = $("#count_s").spinner();
	$("#count_s").val(1);   

	var table = $('#iTable').DataTable();
    var ids = []
    var index = []
	table.rows({ selected: true }).eq( 0 ).each( function (idx) {
		console.log("index = " + idx +" / " + $(table.row( idx ).node()).attr('id') );
		ids.push( $(table.row( idx ).node()).attr('id') );
		index.push( idx );
		$("#buy_c").append("<br>[<mark class='mark_id' indx='"+idx+"'>" + $(table.row( idx ).node()).attr('id') +"</mark>]"+ table.cell( idx,5 ).data());
	});
	$("#dialog_b_buy").attr({"ids": ids});
	$("#dialog_b_buy").attr({"index": index});
});


function showbox(okCallback, cancelCallback) {
	var divId = $('#dialog_edit_email');
    divId.dialog('open').off('confirm cancel').on('confirm', okCallback).on('cancel', cancelCallback);
}


$("body").on('click', '#email_send', function() {
showbox(function(){

//if (confirm("Ви впевненні що хочете відправити лист на пошту rivelo@ymail.com")) {
//	parent.location='http://www.jsp.newmail.ru/les12.htm';
//	console.log("EMAIL_send!!!");

{% if company_id %}	
	$.ajax("/invoice/manufacture/{{company_id}}/availability/view/html/", {
    	type: 'POST',
    	data: {
      		email: $('#email_name').val(), //'rivelo@ymail.com',
    	},
		success: function(msg){
					alert(msg);
        },
  	})	
{% endif %}
{% if category_id %}
	$.ajax("/invoice/category/{{category_id}}/availability/view/html/", {
    	type: 'POST',
    	data: {
      		email: $('#email_name').val(), //email: 'rivelo@ymail.com'
    	},
		success: function(msg){
					alert(msg);
        },
  	})
{% endif %}	
//}
            alert('ok')
        }, function(){
            //alert('cancelled')
        });
    //}

});

/*
function on_off_button(state) {
	var dialog_selector = "#dialog_inventory";
    $(dialog_selector).parent().find("button").each(function() {
        if( $(this).text() == 'Додати' ) {
            $(this).attr('disabled', state);
        }
    });
    $("#inv_spinner").focus()
}
*/


$("body").on('click', '#show_inv', function() {

var table = $('#iTable').DataTable();
	var status = $('#show_hide').attr('val')
	if ( status == 1) {
		$('#show_hide').attr('val', 0);
        }
	
	if ( status == 0) {
		$('#show_hide').attr('val', 1);
		var ids = []

	table.rows().eq( 0 ).each( function (idx) {
		ids.push( $(table.row( idx ).node()).attr('id') );
	});
            $.ajax({
                type: "POST",
                url: "/inventory/get/listid/",
                data: { catalog_ids: JSON.stringify(ids) },
                dataType: "json",
                success:function(msg){
                	$.each(msg,function(index,item){
//						$(".price_edit[id_price="+item['catalog__id']+"]").html(item['count']);
						var inx =  table.row("[id="+ item['catalog__id'] +"]").index();
						table.cell(inx, 15).data('<b>'+item['count']+'</b>');
						//$("tr[id="+item['catalog__id']+"] td.inv_td").html('<b>'+item['count']+'</b>');
                    });
                },
                error:function(xhr, ajaxOptions, thrownError){
                    alert( xhr.responseText );
                }
            });      
	}
});


$("body").on('click', '#span_show_year_select', function() {
//	$("#q_search").hide();
	$(".year_sales").toggle();
});


$("body").on('click', '#span_show_select', function() {
//	$("#q_search").hide();
	$("#q_search").toggle();
});

$("body").on('click', '#price_tag_button', function() {
	var status = $('#price_tag_button').attr('val')
	if ( status == 1) {
		$("div.price_tag").hide();	
		$("#price_tag_button").attr('val', 0);
	}
	if ( status == 0) {
		$("div.price_tag").show();
		$("#price_tag_button").attr('val', 1);
	}
})


function show_tr_year(obj){
	$( "#table_body").find( "tr:not([iyear*='{{cur_year}}'])" ).toggle();
//	$(obj).removeClass('badge-warning').addClass('badge-dark');
	$(obj).toggleClass( 'badge-warning' );
//	$(obj).toggleClass( 'badge-primary' );
	}


function show_year_sales(cell){
    console.log("Click. CELL = " + cell.innerText);
    console.log("ID = " + $(cell).parents('tr').attr('id') );
    cell_id = $(cell).parents('tr').attr('id')
    $.ajax({
        type: "POST",
        url: "/invoice/sales/by/year/",
        data: { catid: cell_id,  }, 
        dataType: "json",
        success: function( data ) {
                    console.log("Status = " + data.status);        
                    if (data.status == false){
                        alert("Сталася помилка: " + data.msg);
                    }
                    else {
                        var st_lines = ""                    	
                    	for (i in data.year_count) {
                    		console.log("Year [" + data.year_count[i]['year'] + "] - " + data.year_count[i]['count']);
                    		//$('#sales_alert').alert();
                    		st_lines = st_lines + "Year [" + data.year_count[i]['year'] + "] - " + data.year_count[i]['count'] + " шт.<br>"
                    	}
                    	
                    	var div_alert = '<div class="alert alert-success alert-dismissible fade show w-30" role="alert" style="float: right">' + st_lines +'   <button type="button" class="close" data-dismiss="alert" aria-label="Close">    	    <span aria-hidden="true">&times;</span></button>	</div>'
                    	$(cell).parents('tr').children('td.c_name').find('div.div_c_name').after(div_alert);
                    	//$(param).parents('div.cat_item:first').remove();                                
                    }
                    
                    }
     });
    
};


</script>


{# <body onload="document.getElementById('tsearch_field').focus()"> #}
<body> 

<!-- Dialog for add boxname to clientinvoice item -->
<div id="dialog_addboxname" title="Виберіть ящик куди покласти товар" id_target="">
<div id="dtext_item">
<label>Товар:</label>
<div class="row catalog_item">
</div>
</div>

<label>Наявні ящики:</label>
<div class="box_container">
<h2>
    <span class="badge badge-primary">
    назва місця
    </span>
     - опис місця знаходження 
</h2>  
    <label for="spinner_addcount">Кількість:</label>
    <input id="spinner_addcount" name="value" value="0" type="number" class="w-100 pl-2">   
</div>    
</div>

<!-- Modal PHOTO -->
<div class="modal fade" id="photoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Фото: {{form.name.value}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="m_content">

{# begin ФОТО карусель #}
<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
  </ol>
  <div class="carousel-inner">
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>  
{# end ФОТО карусель #}
        
      </div>
      <div class="modal-footer">
{% if request.user|has_group:"admin" %}        
      	<button type="button" class="btn btn-info CatalogPhotoList" title="Переглянути привязані фото"  data-toggle="tooltip" data-placement="top"><i class="material-icons">photo_library</i></button>
{% endif %}      	
      	<button type="button" class="btn btn-success photoAddbutton" title="Додати фото"  data-toggle="tooltip" data-placement="top"><i class="material-icons">add_photo_alternate</i></button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" title="Закрити вікно"  data-toggle="tooltip" data-placement="top">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal PHOTO end -->


<div class="row ml-50" id="q_search">
<div class="col-2 ml-50" style="width:300px; float:left;"> 
<select id="m_combobox">
<option value="">Select one...</option>
{% for company in company_list %}
<option value="/invoice/manufacture/{{company.id}}/view/">{{company.name}}</option>
{% endfor %}
</select>
</div>

<div class="col-2"  >
<select id="t_combobox">
<option value="">Select one...</option>
{% for type in type_list %}
<option value="/invoice/category/{{type.id}}/view/">{{type.name}}/{{type.name_ukr}}</option>
{% endfor %}
</select>
</div>
</div>


<div style="clear:left;">
     <h1>
     <span id="span_show_select" class="badge badge-secondary" title="Показати/приховати рядок вибору по категорії/виробнику" data-toggle="tooltip" data-placement="bottom"><i class="material-icons">unfold_more</i></span>
     <span class="badge badge-secondary">Список наявного товару</span> <span class="badge badge-info" id="c_c">{{company_name|capfirst}}{{category_name|capfirst}}</span>
     <span class="badge badge-info">{{head_text}}</span>

{% if category_name %}     
	 <a href="{% url 'category-id-list' category_id %}" title="Показати наявні записи" data-toggle="tooltip" data-placement="top">
     <img src="{{category_name.get_icon_name}}" alt="{{company_name|capfirst}}" width="64px">
     </a>
     <a href="{% url 'category-id-list-all' category_id %}" >
     <span id="all_record_show" class="badge badge-success" title="Показати всі записи" data-toggle="tooltip" data-placement="bottom"><i class="material-icons">more_horiz</i></span>
     </a>
{% if request.user|has_group:"admin" %}
   {% for yy in years_range %}
     <a href="{% url 'invoice_year_category' yy.0 componentlist.0.catalog__type__id %}" class="badge badge-info year_sales">{{yy.0}} 
          <span class="badge badge-light">{{yy.1}}</span>
     </a>
   {% endfor %}  
{% endif %}   
{% endif %}     

{% if company_id %}
     <a href="{% url 'manufacture_id_list_all' company_id %}" >
     <span id="all_record_show" class="badge badge-success" title="Показати всі записи" data-toggle="tooltip" data-placement="bottom"><i class="material-icons">more_horiz</i></span>
     </a>
{% if request.user|has_group:"admin" %}
     {% for yy in years_range %}
     <a href="{% url 'invoice_year_manufacture' yy.0 componentlist.0.manufacturer__id %}" class="badge badge-info year_sales">{{yy.0}} 
          <span class="badge badge-light">{{yy.1}}</span>
     </a>
     {% endfor %}
{% endif %}     
{% endif %}     
   
{% if request.user|has_group:"admin" %}
<span id="span_show_year_select" class="badge badge-info" title="Показати/приховати рядок вибору продажів за рік" data-toggle="tooltip" data-placement="bottom"><i class="material-icons">unfold_more</i></span>     
{#     <span id="email_send"><img src="/media/images/green-mail-send-icon_48.png" width="42" height="42" title="Відправити вибірку на Email" data-toggle="tooltip" data-placement="bottom"></span> #}
     {% if category_id %}
	     <a href="/inventory/type/{{category_id}}/autofix/" title="Звести порахований товар" data-toggle="tooltip" data-placement="bottom"><i class="material-icons md-48 align-middle">playlist_add_check</i> </a>
     {% endif %}
{% endif %}

     <span id="b_buy"><img src="/media/images/Ecommerce Buy.ico" width="32" height="32" title="Додати до кошика вибрані позиції" data-toggle="tooltip" data-placement="bottom"> </span>
     
     {# url 'invoice_year_manufacture' 2018 componentlist.0.manufacturer__id #}
     <span class="badge badge-danger">{{category_name.get_discount.0}}</span>
     <span class="badge badge-danger">{{company_name.get_discount.0}}</span>
{#     <span class="badge badge-warning">{{cat_discount.0}}</span> #}
     </h1>
</div>

<!-- Dialog print PHPbb -->
	<div id="dialog_print" title="Текст для повідомлень">

	{# <div id="print_container"> #}
	<div id="print_container" onclick="copy2clipboard()" hidden>
	</div>
	<input type="text" id="inputLink" value="" style="display:none" >

<textarea id="copyTarget" class="w-100">

</textarea>
	<span id="copyButton" class="input-group-addon btn" title="Click to copy">
      <i class="material-icons">content_copy</i> 
    </span>
	</div>


<!-- Dialog to edit email -->
	<div id="dialog_edit_email" title="Edit email">
	<p id="emtext">Адреса для відправки пошти:</p>
	<label for="spinner">Введіть Email:</label>
  	<input type="text" id="email_name" value="" size="45">
	</div>


<!-- Dialog to add print price -->
	<div id="dialog" title="Add price">
	<p id="dtext">Додати цінник до списку друку</p>
	<label for="spinner">Кількість:</label>
  	<input id="spinner" name="value" value="1" type="number" class="w-100 pl-2">	
	</div>


<!-- Dialog to join catalog -->
	<div id="dialog_catalog_join" title="Обєднання товарів">
	<p id="jtext">Об'єднати компоненти:</p>
	<label for="spinner">ID компонента:</label>
  	<input type="text" id="main_id" name="value" value="">
	</div>


<!-- Dialog to change catalog sale -->
	<div id="dialog_change_sale" title="Знижка на товар">
	<p id="sel_c">Змінити знижку на компоненти:</p>
	<label for="spinner">Знижка %:</label>
  	<input type="text" id="sale_p" name="value" value="">
	</div>

<!-- Dialog to change catalog type -->
	<div id="dialog_change_type" title="Зміна категорії" >
	<p id="sel_c">Змінити категорію для компонентів:</p>
	<label for="spinner">Категорія:</label>
  	<input type="text" id="s_category" name="value" value="" class="w-100">
	</div>

<!-- Dialog to change parametr/attribute -->
    <div id="dialog_add_param" title="Додавання параметрів" >
    <p id="sel_c_param">Додати пераметр/властивість компонентам:</p>
    <label for="spinner">Параметр/властивість:</label>
    <input type="text" id="s_param" name="value" value="" class="w-100">
    </div>

<!-- Dialog to add components to basket -->
	<div id="dialog_b_buy" title="Продати товар">
	<p id="buy_c">Змінити знижку на компоненти:</p>
	<label for="spinner">Кількість:</label>
  	<input type="text" id="count_s" name="value" value="1">
	</div>

<!-- Dialog to add youtube video -->
	<div id="dialog_youtube_add" title="Add YouTube video">
	<h4 id='cat_name_youtube'></h3>
	<div id="youtube_content"></div>
	<label for="youtube_url">Посилання на youtube:</label>
	<input type="text" name="youtube" id="youtube_url" value="" ids="" class="w-100">
	</div>

<!-- Dialog to add photo -->
	<div id="dialog_photo_add" title="Add Photo">
	<label for="photo_url">Посилання на фото:</label>
	<input type="text" name="photoname" id="photo_url" value="" onfocus="this.value=''" placeholder="Посилання повинно починатись з http:// або https://" ids="" size="75"> 

	</div>

<!-- Dialog to view photo -->
	<div id="dialog_photo" title="Photo">
	</div>

<!-- Dialog to view inventory -->
	<div id="dialog_inventory" title="Inventory">
{% comment %}
	<label for="inv_spinner">Кількість:</label>
  	<input id="inv_spinner" name="value" value="1">
  	<label for="inv_chkbox">Загальна кількість?:</label>
  	<input type="checkbox" name="chk_all" id="chk_all" value="" ids="" >
  	<label>User: <b> {{user|upper}} </b></label>
  	<br>
  	<label for="photo_url">Опис:</label>
	<input type="text" name="inv_description" id="inv_desc" value="" ids="" size="55">
{% endcomment %}

<div class="input-group mb-3">
  <div class="input-group-prepend">
    <span class="input-group-text" id="basic-addon1">Кількість</span>
  </div>
  <input type="text" class="form-control" aria-label="Имя пользователя" aria-describedby="basic-addon1" id="inv_spinner" name="value" value="1">
  <div class="input-group-prepend">
    <span class="input-group-text" id="basic-addon1">User: <b> {{user|upper}} </b></span>
  </div>
</div>
<div class="input-group mb-3">
  <div class="input-group-prepend">
    <div class="input-group-text">
      <input type="checkbox" aria-label="Checkbox for following text input"  name="chk_all" id="chk_all" value="" ids="">
    </div>
  </div>
  <input type="text" class="form-control" aria-label="Text input with checkbox" placeholder="Опис" id="inv_desc" value="" ids="">
</div>	
	
  	<h3 class="w-100">Список перевірок: <span class="badge badge-ligth float-right" onclick="show_tr_year(this);" style="cursor: pointer;"> 
  	<i class="material-icons">view_list</i></span> 
  	</h3>
  	<div class="container w-100">
  	<table class="table table-bordered table-hover table-condensed table-sm" >
<thead class="table-dark text-center">
  <tr>
    <th>Дата</th>
    <th>Опис</th>
    <th>Кількість</th>
    <th>Статус</th>
    <th>Кількість в базі</th>
{% if request.user|has_group:"admin" %}	    
    <th>Дія</th>
{% endif %}    
  </tr>
</thead>
  <tbody id="table_body">
  
  </tbody>  	
  	</table>
	</div>
	</div>

    <table id="iTable" class="display compact" cellspacing="0" width="100%"> 
    {# <table id="iTable" class="display" cellspacing="0" width="100%" border="1"> #}
    <thead>
	<tr>
    	<th ROWSPAN="2">#</th>	
    	<th ROWSPAN="2">ID</th>
    	<th ROWSPAN="2">Тип</th>
    	<th ROWSPAN="2">Виробник</th>
    	<th ROWSPAN="2">Y</th>
    	<th ROWSPAN="2">Ф</th>
    	<th ROWSPAN="2" width="90%">Найменування товару</th>
    	
    	<th align="center" COLSPAN="3" >Кількість</th>
    	
    	<th ROWSPAN="2" width="10%">Ціна</th>
    	<th ROWSPAN="2">Знижка</th>
    	<th ROWSPAN="2">Сума</th>
    	<th ROWSPAN="2" width="5%">Опис</th>
    	<th ROWSPAN="2">Місце</th>
    	<th ROWSPAN="2">Інв.</th>
    	
    </tr>
    
    <tr>
    	<th align="center" >
    	<i class="material-icons" title="Прихід в магазин" data-toggle="tooltip" data-placement="top">local_shipping</i>
    	</th>
    	<th align="center" title="Продажі" data-toggle="tooltip" data-placement="top">
    	<i class="material-icons">transfer_within_a_station</i>
    	</th>
    	<th align="center" title="Наявність в магазині" data-toggle="tooltip" data-placement="top"><i class="material-icons">store_mall_directory</i></th>
    	
    </tr>
    </thead>
    
<tbody>
    
     
{% load template_math %}    

{% comment %}
{% if request.user|has_group:"admin" %}
{% endcomment %}

{% for type in componentlist %}

{% ifequal type.sum_catalog type.c_sale %}
<tr class="zero" id="{{type.catalog}}">
{% else %}
{% ifequal type.balance 1 %}
<tr class="last" id="{{type.catalog}}">
{% else %}
<tr id="{{type.catalog}}">
{% endifequal %}
{% endifequal %}


	<td>
	<p href="/shop/price/print/{{type.catalog}}/add" class="addprice" ids="{{type.catalog}}"> {{forloop.counter}}</p>
	</td>
	<td>       
		<a href="/catalog/id/{{type.catalog}}/view">{{type.catalog}}</a>
	<br>
	<abbr title="{{type.catalog__user_update__username}} - {{type.catalog__last_update|date_left}}д"> 
	<font size="0" color="black" >
	{{type.last_update|date:"d/m/Y"}}
	</font>
	</abbr>
	</td>
		
	<td class="edit_type" id_type="{{type.catalog}}" cat_id="{{type.catalog__type__id}}">
	<a href="/invoice/category/{{type.catalog__type__id}}/view/">{{type.catalog__type__name}} / {{type.type__name_ukr}}</a>
	</td>
	<td>
	<a href="/invoice/manufacture/{{type.manufacturer__id}}/view/">{{type.manufacturer__name}}</a>
	</td>

<td align="center" id="youtube_{{type.catalog}}" youtube_id="{{type.youtube_url}}">
{% if type.youtube_url != None %}
	<img class="c_youtube" id="link_{{type.catalog}}" url="" ids="{{type.catalog}}"  src="/media/images/youtube-48.png" width="24" height="24">
{% else %}
	<img class="c_youtube" id="link_{{type.catalog}}" url="" ids="{{type.catalog}}" src="/media/images/youtube-48_greyscale.png" width="24" height="24">
{% endif %}
</td>	
	
{% if type.catalog__last_update|date_left < 30  %}
	<td align="center" id="td_{{type.catalog}}" bgcolor="#efc9e7">
{% else %}
	<td align="center" id="td_{{type.catalog}}">
{% endif %}	

{% if type.photo_url != None %}
{#	<img class="c_photo" id="link_{{type.catalog}}" url="" ids={{type.catalog}} src="/media/images/photo_ico_true.png" width="24" height="24"> #}
	<span class="photoModalbutton" style="color:#17aa35" pk_catalog={{type.catalog}} title="Фото"  data-toggle="tooltip" data-placement="right"><i class="material-icons">photo_library</i></span>
{% else %}
{#	<img class="c_photo" id="link_{{type.catalog}}" url="" ids={{type.catalog}} src="/media/images/photo_ico.png" width="24" height="24"> #}
	<span class="photoModalbutton" pk_catalog={{type.catalog}} title="Фото"  data-toggle="tooltip" data-placement="right"><i class="material-icons">photo_library</i></span>
{% endif %}	
	</td>
	<td class="c_name" data-name="[{{type.catalog__ids}}] {% if type.catalog__dealer_code %} [{{type.catalog__dealer_code}}] {% endif %} - ({{type.catalog__manufacturer__name}}) {{type.catalog__name}}">
<div class="div_c_name">	
	[{{type.catalog__ids}}] {% if type.catalog__dealer_code %} [{{type.catalog__dealer_code}}] {% endif %}- ({{type.catalog__manufacturer__name}}) {{type.catalog__name}}  

	{% if type.catalog__date %} 
          <span class="modal-body" data-toggle="datepicker">
	    [{{type.catalog__date}}]
	      </span> 
	{% endif %}
</div>	
<div class="price_tag">
<span class="material-icons addboxname" title="Додати товар до ящику" data-toggle="tooltip" data-html="true" data-placement="left">
input
</span>
<a href="{% url 'shop-price-by-search-id-print' type.catalog__ids %}" title="Друкувати цінник">
<span class="material-icons">
local_offer
</span>
</a>
</div>
{% comment %}	
	<span class="fa fa-calendar-o red-icon"></span>
	<span class="typcn typcn-social-youtube green-icon”> text</span>
<a class="btn btn-small bg-primary" href="#"><i class="icon-star"> </i></a>
{% endcomment %}
	
	</td>
	
	<td align="center">
	<a href="/invoice/catalog/{{type.catalog}}/view/" title="Надходження" data-toggle="tooltip" data-placement="top">
	{{type.sum_catalog}}
	</a>
	</td>
	<td align="center" class="prev_sales" onclick="show_year_sales(this);">
	<a href="/client/invoice/catalog/{{type.catalog}}/view/" title="Проданий товар" data-toggle="tooltip" data-placement="top">
	{{type.c_sale|floatformat }}
	</a>
	</td>
{% if type.new_arrival %}	
	<td align="center" bgcolor="#c8c2f9" class="sale_td_url" title="Продати товар" data-toggle="tooltip" data-placement="top" data-order="{{type.balance|floatformat}}">
{% else %}
	<td align="center" class="sale_td_url" title="Продати товар" data-toggle="tooltip" data-placement="top" data-order="{{type.balance|floatformat}}">
{% endif %}	
{% ifequal type.sum_catalog type.c_sale %}
	{{type.sum_catalog|sub:type.c_sale|floatformat}} 
{% else %}
		
{% if type.new_arrival %}
	<a href="/client/invoice/catalog/{{type.catalog}}/add" title="{{type.new_arrival}}" data-toggle="tooltip" data-placement="top">
	{{ type.balance|floatformat }}
{% else %}
	<a href="/client/invoice/catalog/{{type.catalog}}/add" > {#</a>title="Продати товар" data-toggle="tooltip" data-placement="top">#}
	{{ type.balance|floatformat }}	
{% endif %}		
	</a>
	{% if request.user|has_group:"admin" %}
	<span class="badge badge-light" title="реальна кількість" data-toggle="tooltip" data-placement="bottom">{{ type.get_realshop_count }}</span>
	{% endif %}
{% endifequal %}
	</td>

{# колонка Ціна #}
	
{% ifequal type.catalog__sale 0 %}
<td align="center" {% if request.user|has_group:"admin" %} class="price_edit" {% endif %} id_price={{type.catalog}}>
{% if type.catalog__price > type.catalog__last_price %} 
{{type.catalog__price}} грн.
{% if type.catalog__last_price %}
	<img src="/media/images/discount_up.png" width="30" height="30">
{% endif %}
{% endif %}
{% if type.catalog__price < type.catalog__last_price %} 
{{type.catalog__price}} грн.
{% if type.catalog__last_price %}
	<img src="/media/images/discount_down.png" width="30" height="30">
{% endif %}
{% endif %}
{% if type.catalog__price == type.catalog__last_price %}
{{type.catalog__price}} грн.
{% endif %}
{% if type.get_discount %}
<h5><span class="badge badge-danger">{{type.get_discount|floatformat:"0"}}</span></h5>
{% endif %}
</td>
{% else %}
<td align="center" BGCOLOR="#FF6600" class="price_edit" id_price={{type.catalog}}>
<abbr title="Знижка - {{type.catalog__sale}}%. Ціна зі знижкою {{type.catalog__sale|div:100|sub:1|mul:type.catalog__price}}">
<s style="font-size:small">{{type.catalog__price}} грн.</s><br>
<b>{{type.catalog__sale|div:100|sub:1|mul:type.catalog__price|mul:-1}} грн.</b>
</abbr>
</td>
{% endifequal %}

{# row Sale #}	
	<td align="center" class="sale_edit">
	{{type.catalog__sale}}
	</td>

{# row Sum #}
{% if type.invoice_price.2 <= 10 %}	
	<td align="center" bgcolor="#f70421" style="color:white;">
{% else %}
	<td align="center">
{% endif %}	    

{% comment %}
	{{type.catalog__price|mul:type.balance}}
{% endcomment %}

{% if request.user|has_group:"admin" %}	
	{{type.invoice_price.0|floatformat:"0"}} <br> {{type.invoice_price.1|floatformat:"0"}} грн. ({{type.invoice_price.2|floatformat:"0"}}%)
{% endif %}	
	</td>

	
{% if user.is_authenticated %}	
	<td align="center" id_desc={{type.catalog}} class="td_desc">
{% else %}
	<td align="center">
{% endif %}	
	{{type.description}}
	</td>
	<td align="center" class="locality_edit" id_locality="{{type.catalog}}" title="{{type.box_name|join:"<br>"}}" data-toggle="tooltip" data-placement="bottom" data-html="true">
	{#{type.locality}#}
	{#{type.box_name|join:"<br>"}#}
	
{% for b_name in type.box_name	%}
	{#{ b_name|truncatewords:1 }#}
	{{ b_name|truncatechars_html:16 }}
{% endfor %}

	</td>
	<td class="inv_td" align="center" cap="[{{type.catalog__ids}}] - ({{type.catalog__manufacturer__name}}) {{type.catalog__name}}">
 	<img  class="inventory" id="link_{{type.catalog}}" url="" ids={{type.catalog}} src="/media/images/Inspection.png" width="50" height="50">
	</td>
</tr>
{% endfor %}


{% comment %}
{% endif %}
{% endcomment %}

</tbody>
<tfoot>      
	<tr>
    	<th></th>
    	<th></th>	
    	<th></th>
    	<th></th>
    	<th></th>    	    	
    	<th></th>
    	<th></th>
    	<th></th>
    	<th></th>
    	<th>Сума: {{zcount|floatformat}}</th>
    	<th></th>    	
    	<th>{{zsum}} грн.</th>
    	<th></th>
    	<th></th>
    	<th></th>    	    	    	    	
    </tr>
</tfoot>    
</table>
    
    

{% orm_debug %}
</body>
</html>