<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Майстерня</title>

<link rel="stylesheet" type="text/css" href="/media/css/table.css">
<link type="text/css" rel="stylesheet" href="/media/css/jquery.qtip.min.css" />

<script type="text/javascript" src="/media/js/jquery.qtip.min.js"></script>

{% load poll_extras %}

<style>

.badge-warning{
	background-color: #eded21;
}

.badge-warning[href]:hover{
	background-color: #FFFF99;
}

</style> 

<script language="JavaScript">

function resWorkshop()
{
var p=0;
var All=document.forms['formWorkshopSum'];
for(var i = 0; i < All.elements.length; ++i) {
	if(All.elements[i].checked){
	p+=parseFloat(All.elements[i].value);
	}
	document.getElementById('workshop_pay').innerHTML = "До оплати: <br>" + p.toFixed(2)+" грн.";
}
}

$(document).ready(function() {
	
	$('[title!=""]').qtip({
	    position: {
	        at: 'top left'
	    }
	});
	
	
 $(".w_del").click(function(){

 if (confirm("Ви дійсно бажаєте видалити запис?")) {
 	console.log($(this).parents("tr"));
 	console.log("log = "+$(this).attr("id_work"));
	$(this).parents("tr").remove();
		$.ajax({
                type: "POST",
                url: "/workshop/delete/",
                data: {id:  $(this).attr("id_work") },
                dataType: "text",
                success:function(data){
                	console.log("ajax work");
                },
                error:function(data){
                    alert("Виникли проблеми з сервером" + data);
                }
            });	
 }
	
 });
});
    
</script>

<body onLoad="resWorkshop()">

<br>
<h2>
	За місяць: 
	{% for i in "123456789012" %}
	{% ifequal forloop.counter sel_month %}
    <a href="/workshop/year/{{sel_year}}/month/{{forloop.counter}}/view" class="badge badge-success select">{{forloop.counter}}</a>
    {% else %}
    <a href="/workshop/year/{{sel_year}}/month/{{forloop.counter}}/view" class="badge badge-success">{{forloop.counter}}</a>
    {% endifequal %}
	{% endfor %}
</h2>    

<h2>
	За день:
	{% for day in month_days %}		 
	{% ifequal day sel_day %}
    <a href="/workshop/year/{{sel_year}}/month/{{sel_month}}/day/{{day}}/view" class="badge badge-success select">{{day}}</a>
    {% else %}
    <a href="/workshop/year/{{sel_year}}/month/{{sel_month}}/day/{{day}}/view" class="badge badge-success">{{day}}</a>
    {% endifequal %}
    {% endfor %}
</h2>    

    <h1>Виконані роботи за {{sel_day}}/{{sel_month}}/{{sel_year}} року <a href="/workshop/add/" class="badge badge-pill badge-light">(Додати роботу)</a></h1>
	
<form action="/payform/workshop/" method="post" name="formWorkshopSum">
<br> 
    <table id="iTable" class = "table table-bordered table-hover table-condensed">
    <tr>
    	<th>#</th>
{#    	<th>ID</th> #}
    	<th>Клієнт</th>
    	<th>Дата завершення</th>
    	<th>Робота</th>
    	<th>Ціна (грн.)</th>
    	<th>Опис</th>
    	<th>Редагування</th>
{% if user.is_authenticated %}	    	
    	<th>Дія</th>
{% endif %}    	
    	<th></th>
    </tr>
 
{% for type in workshop %}
{% if type.pay %}	
<tr id="row_{{type.id}}">	
{% else %}
<tr BGCOLOR="#F2AE6B" id="row_{{type.id}}">
{% endif %}
	<td title="Створено користувачем {{type.user.username}}">
	{{forloop.counter}}
	</td>  
{#	<td title="Створено користувачем {{type.user.username}}">	{{type.id}}	</td> #}
	<td>       
	<a href="/client/result/search/?id={{type.client.id}}">
	{{type.client.name}} {% if type.client.forumname %} ({{type.client.forumname}}) {% endif %}   
	</a>
	</td>
	<td align='center'>       
	{{type.date|date:'d-m-Y H:i' }}
	</td>
	<td>       
	{{type.work_type}}
	</td>	
	<td align='center'>       
	{{type.price}}
	</td>
	<td>       
	{{type.description}}
	</td>
	<td align='center'>
	<a href="/workshop/edit/{{ type.id }}">edit</a>
{% comment %}	{% if perms.accounting.delete_workshop %} 
{% endcomment %}
	</td>
	
{% if user.is_authenticated %}
	<td align='center'>
<!--     <a href="/workshop/delete/{{ type.id }}" onclick="return confirm('Видалити роботу?')">delete</a>  -->
    <span class="w_del" id_work={{type.id}} style="cursor: pointer;">Видалити</span>
    </td>
{% endif %}
    
    <td>
{% if type.pay %}    
   	<input type="checkbox" id="model_workshop{{forloop.counter}}" value="{{type.price}}" onclick="resWorkshop()" name="checkbox_{{ type.id }}"/>
{% else %}
   	<input type="checkbox" id="model_workshop{{forloop.counter}}" value="{{type.price}}" onclick="resWorkshop()" checked name="checkbox_{{ type.id }}"/>
{% endif %}
    </td>
</tr>
{% endfor %}   

<tr>
{#    	<th></th> #}
    	<th></th>
    	<th></th>
    	<th></th>
    	<th></th>
    	<th>
{% if request.user|has_group:"admin" %}    	
    	{{summ}} грн.
{% endif %}    	
		</th>
    	<th>
    	<input type="submit" value="E-mail" name="send_check" id="send_check"> 
<!--     	 onClick="return confirm('Створити і надіслати листа?')">   -->
    	</th>
    	<th>	
<!--     	<p><input type="submit" value="Оплата" name="pay" onClick="return confirm('Провести операцію?')"></p>
 -->		
      <p><input type="submit" value="Оплата" name="pay"></p>
		</th>
    	<th id="workshop_pay"></th>
    	<th></th>
</tr> 

</table>
<br>

</form>

