<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>

.carousel-indicators li {
	cursor: pointer;
    background-color: #5bb600;
}

.carousel-control-prev-icon { 
	background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%235bb600' viewBox='0 0 8 8'%3E%3Cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3E%3C/svg%3E"); 
}
.carousel-control-next-icon {
  	background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%235bb600' viewBox='0 0 8 8'%3E%3Cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3E%3C/svg%3E") !important;
}


</style>


<script type="text/javascript">

function sum() {
	sale = 1 - ((parseFloat(document.getElementById('id_sale').value)||0)/100)
    res = document.getElementById('result').innerHTML = (parseFloat(document.getElementById('id_price').value)||0) * sale
    document.getElementById('result').innerHTML = "Сума " + document.getElementById('result').innerHTML + " грн."
    document.getElementById('id_sum').value = res 
}

$(document).ready( function() {
	$( "input" ).change(function(){
  		sum();
	});

//	$('#id_photo_url').parent('tr').after($('#show_photo')); //.append(  );
	($('#id_photo_url').parents('tr').find('th')).append($('#show_photo'));

	$('#photoModal').on('show.bs.modal.bs.modal', function (e) {
		  
		$.ajax({
            type: "POST",
            url: "/photo/url/get/",
            data: {id:  {{cat_pk}} },
            dataType: "json",
            success:function(data){

            var st = JSON.stringify(data);
			var p = jQuery.parseJSON(st);
//			console.log("aData = " + data.aData.length);
			$(".carousel-inner").empty();
			$(".carousel-indicators").empty();
			
			if (data.aData.length > 0) {
					
				$("#exampleModalLongTitle").html("Фото - " + p.cname); //aData[0].id); 
					$.each(p.aData,function(index, item){
						if (index == 0){
							str_photo = '<div class="carousel-item active"><img id="image_' + index + '" src="'+ item.www + '" class="d-block w-100"></div>'
							str_indicator = '<li data-target="#carouselExampleIndicators" data-slide-to="' + index + '" class="active"></li>'
						}
						else {
							str_photo = '<div class="carousel-item"><img id="image_' + index + '" src="'+ item.www + '" class="d-block w-100"></div>'
							str_indicator = '<li data-target="#carouselExampleIndicators" data-slide-to="' + index + '"></li>'
						}
						
//						console.log("APPEND_INDICATOR = " + str_indicator);
//						console.log("APPEND = " + str_photo);
						$(".carousel-inner").append(str_photo);
						$(".carousel-indicators").append(str_indicator);
					})
				}
				else {
			   		/* $("#photo_url").attr({'ids': p.id});
			   		$("#dialog_photo_add").dialog({ title: p.cname });
						$("#dialog_photo_add").dialog("open");
						
						$("#photo_url").select();*/
				}   					
            },
            error:function(){
                alert("При відправці виникли проблеми");
            }
        });		
		
		});	
	
})




</script>

<body onload="document.getElementById('id_ids').focus()">



 
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#photoModal" id="show_photo">
  <i class="material-icons">insert_photo</i>
</button>

<!-- Modal PHOTO -->
<div class="modal fade" id="photoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Фото: {{form.name.value}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="m_content">

{# begin ФОТО карусель #}
<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
{% for photo_url in catalog_obj %}  
    <li data-target="#carouselExampleIndicators" data-slide-to="{{forloop.counter0}}" class="{% if forloop.counter0 = 0 %} active {% endif %}"></li>
{% endfor %}
  </ol>
  <div class="carousel-inner">
{% for photo_url in catalog_obj %}
    <div class="carousel-item {% if forloop.counter = 1 %} active {% endif %} ">
      <img class="d-block w-100" src="{{photo_url.www}}" alt="photo{{forloop.counter}}" >
    </div>
{% endfor %}
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>  
{# end ФОТО карусель #}
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal PHOTO end -->

<h1><span class="badge badge-secondary">Додати/Редагувати опис запчастини</span></h1>

    
    <form action="" method="POST" enctype="multipart/form-data">
    <input type="submit" value="Зберегти" type="button" class="btn btn-success w-100%" >
        <table>
            {{ form.as_table }}
        </table>
        <h3 id="result" style="color:red; background-color:#CCCCCC"}>Ціна зі знижкою грн.</h3>
{#	<input type="submit" value="Зберегти" type="button" class="btn btn-success w-100%" > #}            
    </form>
    <br>
    

<span>{{ form.photo_url.value }}</span>
<span>{{ form.name.value }}</span>

</body>



